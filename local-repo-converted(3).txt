Selected Files Directory Structure:

â””â”€â”€ ./
    â””â”€â”€ Dashboard_temp
        â”œâ”€â”€ app
        â”‚   â”œâ”€â”€ static
        â”‚   â”‚   â”œâ”€â”€ css
        â”‚   â”‚   â”‚   â”œâ”€â”€ base
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ base.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ colors.css
        â”‚   â”‚   â”‚   â”‚   â””â”€â”€ variables.css
        â”‚   â”‚   â”‚   â”œâ”€â”€ components
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ hero
        â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ hero-section.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ background-shapes.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ behavior-card.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ card-footer.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ charts_panel.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ hero-section.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ illustrations.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge-card.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ main-cards.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ map_controls.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ small-cards.css
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ visual_analytics.css
        â”‚   â”‚   â”‚   â”‚   â””â”€â”€ wellbeing-card.css
        â”‚   â”‚   â”‚   â”œâ”€â”€ layout
        â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.css
        â”‚   â”‚   â”‚   â”‚   â””â”€â”€ main-content.css
        â”‚   â”‚   â”‚   â””â”€â”€ main.css
        â”‚   â”‚   â””â”€â”€ js
        â”‚   â”‚       â”œâ”€â”€ components
        â”‚   â”‚       â”‚   â”œâ”€â”€ hero-charts
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ anxiety-bar-chart
        â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ chart-config.js
        â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ chart-data.js
        â”‚   â”‚       â”‚   â”‚   â”‚   â””â”€â”€ chart-events.js
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ anxiety-face-animation
        â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ animations.js
        â”‚   â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ elements.js
        â”‚   â”‚       â”‚   â”‚   â”‚   â””â”€â”€ observers.js
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ anxiety-bar-chart.js
        â”‚   â”‚       â”‚   â”‚   â””â”€â”€ anxiety-face-animation.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ map
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ api.js
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ app.js
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ choroplethRenderer.js
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ config.js
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ mapRenderer.js
        â”‚   â”‚       â”‚   â”‚   â”œâ”€â”€ navigation.js
        â”‚   â”‚       â”‚   â”‚   â””â”€â”€ patternRenderer.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ digital_time_chart.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ dropdown-animation.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ header-title-animation.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ hero-chart.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ hero-charts.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ hero-text-animation.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ lightbulb-animation.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ loan_panel.js
        â”‚   â”‚       â”‚   â”œâ”€â”€ scales-animation.js
        â”‚   â”‚       â”‚   â””â”€â”€ wellbeing-animation.js
        â”‚   â”‚       â”œâ”€â”€ animations.js
        â”‚   â”‚       â”œâ”€â”€ background-shapes.js
        â”‚   â”‚       â”œâ”€â”€ chart-styler.js
        â”‚   â”‚       â”œâ”€â”€ counter.js
        â”‚   â”‚       â”œâ”€â”€ main.js
        â”‚   â”‚       â”œâ”€â”€ new_charts_animations.js
        â”‚   â”‚       â””â”€â”€ scrollTrigger.js
        â”‚   â”œâ”€â”€ templates
        â”‚   â”‚   â”œâ”€â”€ components
        â”‚   â”‚   â”‚   â”œâ”€â”€ behavior-card.html
        â”‚   â”‚   â”‚   â”œâ”€â”€ digital_time_spent.html
        â”‚   â”‚   â”‚   â”œâ”€â”€ hero-section.html
        â”‚   â”‚   â”‚   â”œâ”€â”€ knowledge-card.html
        â”‚   â”‚   â”‚   â”œâ”€â”€ loan_overview.html
        â”‚   â”‚   â”‚   â”œâ”€â”€ map_panel.html
        â”‚   â”‚   â”‚   â”œâ”€â”€ visual_analytics.html
        â”‚   â”‚   â”‚   â””â”€â”€ wellbeing-card.html
        â”‚   â”‚   â”œâ”€â”€ index.html
        â”‚   â”‚   â””â”€â”€ layout.html
        â”‚   â”œâ”€â”€ utils
        â”‚   â”‚   â”œâ”€â”€ charts
        â”‚   â”‚   â”‚   â”œâ”€â”€ diverging_chart.py
        â”‚   â”‚   â”‚   â”œâ”€â”€ education_chart.py
        â”‚   â”‚   â”‚   â”œâ”€â”€ grouped_chart.py
        â”‚   â”‚   â”‚   â””â”€â”€ profession_chart.py
        â”‚   â”‚   â”œâ”€â”€ __init__.py
        â”‚   â”‚   â”œâ”€â”€ chart_generator.py
        â”‚   â”‚   â”œâ”€â”€ engagement_processor.py
        â”‚   â”‚   â””â”€â”€ loan_processor.py
        â”‚   â”œâ”€â”€ __init__.py
        â”‚   â”œâ”€â”€ routes.py
        â”‚   â””â”€â”€ services.py
        â”œâ”€â”€ .gitignore
        â”œâ”€â”€ METRIC_CALCULATION.md
        â”œâ”€â”€ requirements.txt
        â”œâ”€â”€ run.py
        â””â”€â”€ STYLE_GUIDE_PROMPT.md



--- Dashboard_temp/.gitignore ---

venv

# Python bytecode / caches
__pycache__/
*.py[cod]
*.so
*.pyd

# Packaging / build
build/
dist/
*.egg-info/
.eggs/
pip-wheel-metadata/

# Virtual environments (variants)
env/
ENV/
.env/
.venv/

# Environment & secrets
*.env
*.env.*
*.secret
*.key
*.pem
*.crt
service_account*.json
credentials*.json

# Tool caches
.pytest_cache/
.coverage
htmlcov/
.mypy_cache/
.ruff_cache/
.dmypy.json
.pyre/
.cache/

# Editors / IDE
.vscode/
.idea/
*.swp

# OS files
.DS_Store
Thumbs.db
desktop.ini

# Logs & temp
*.log
*.tmp
*.bak
*.orig

# Node / frontend (future)
node_modules/
npm-debug.log*
yarn-error.log*
pnpm-lock.yaml
package-lock.json
*.tsbuildinfo
.cache/
dist/
public/build/

# Static build artifacts (if generated)
app/static/assets/
app/static/.cache/

# Jupyter (if used)
.ipynb_checkpoints/

# Plotly export images (optional)
plotly_exports/

# Do NOT ignore datasets
!dataset/*.csv

--- Dashboard_temp/app/static/js/counter.js ---

// Animate counter values
function animateCounter(elementId, targetValue, duration = 2) {
    const counter = { val: 0 };
    gsap.to(counter, {
        val: targetValue,
        duration: duration,
        ease: "power1.inOut",
        onUpdate: () => {
            document.getElementById(elementId).textContent = Math.round(counter.val);
        },
        scrollTrigger: {
            trigger: `#${elementId}`,
            start: "top 90%",
        }
    });
}

// Animate all small card values
function animateSmallCardValues() {
    gsap.utils.toArray(".small-card .value").forEach(el => {
        const targetValue = el.dataset.value;
        const counter = { val: 0 };
        gsap.to(counter, {
            val: targetValue,
            duration: 2,
            ease: "power1.inOut",
            onUpdate: () => {
                el.textContent = Math.round(counter.val);
            },
            scrollTrigger: {
                trigger: el,
                start: "top 90%",
            }
        });
    });
}

--- Dashboard_temp/app/static/js/components/hero-text-animation.js ---

function initHeroTextAnimation() {
    // Animate the main hero title
    const heroTitle = document.querySelector('.hero-title');
    if (heroTitle) {
        // Split the title into characters
        const chars = heroTitle.textContent.split('').map(char => {
            const span = document.createElement('span');
            span.textContent = char;
            // MODIFIED: Removed the line that converted spaces to &nbsp;
            // The browser will now correctly handle wrapping.
            return span;
        });
        heroTitle.innerHTML = '';
        heroTitle.append(...chars);

        // Animate characters with GSAP
        gsap.from(chars, {
            yPercent: 100,
            opacity: 0,
            duration: 0.8,
            ease: "power3.out",
            stagger: 0.03,
            delay: 0.2
        });
    }

    // Animate the description paragraph
    const heroDescription = document.querySelector('.hero-description');
    if (heroDescription) {
        // Split the paragraph into lines for a line-by-line reveal
        const lines = heroDescription.innerHTML.split('<br>').map(lineText => {
            const lineWrapper = document.createElement('div');
            lineWrapper.className = 'line-wrapper';
            const lineContent = document.createElement('div');
            lineContent.className = 'line-content';
            lineContent.innerHTML = lineText.trim();
            lineWrapper.appendChild(lineContent);
            return lineWrapper;
        });
        heroDescription.innerHTML = '';
        heroDescription.append(...lines);

        // Animate lines with GSAP
        gsap.from('.line-content', {
            yPercent: 110,
            duration: 1,
            ease: "power3.out",
            stagger: 0.15,
            delay: 0.5
        });
    }
}

--- Dashboard_temp/app/static/js/components/map/api.js ---

export async function fetchApiData(endpoint) {
    const res = await fetch(endpoint);
    if (!res.ok) throw new Error(`Gagal mengambil data dari ${endpoint}`);
    return res.json();
}

export async function fetchGeoJSON(url) {
    const res = await fetch(url);
    if (!res.ok) throw new Error('Gagal memuat file peta.');
    return res.json();
}


--- Dashboard_temp/app/static/js/components/map/mapRenderer.js ---

// Deprecated: split into navigation.js, choroplethRenderer.js, patternRenderer.js
export { attachNavigationEnhancements } from './navigation.js';
export { renderChoroplethMap } from './choroplethRenderer.js';
export { renderPatternMap } from './patternRenderer.js';


--- Dashboard_temp/app/static/js/components/map/navigation.js ---

export function attachNavigationEnhancements(chart) {
    const mv = chart.mapView;
    if (!mv) return;
    const initialCenter = mv.center && mv.center.slice ? mv.center.slice() : null;
    const initialZoom = mv.zoom;

    const resetButton = document.getElementById('reset-zoom-btn');
    if (resetButton) {
        resetButton.addEventListener('click', () => {
            if (initialCenter != null && typeof initialZoom === 'number') {
                mv.setView(initialCenter, initialZoom, { duration: 600, easing: 'easeOutCubic' });
            }
        });
    }

    chart.container?.addEventListener('dblclick', () => {
        if (initialCenter != null && typeof initialZoom === 'number') {
            mv.setView(initialCenter, initialZoom, { duration: 600, easing: 'easeOutCubic' });
        }
    });
}


--- Dashboard_temp/app/static/js/components/map/patternRenderer.js ---

import { appColors } from './config.js';
import { attachNavigationEnhancements } from './navigation.js';

export function renderPatternMap({
    mapData,
    currentApiData,
    config,
    metricDetails,
    reverseNameMapping,
    selectedMetric,
    datasetKey,
    containerId = 'container'
}) {
    if (!currentApiData || !mapData) return;

    // Build mapping appName -> numeric category index for dataClasses legend
    const appIndexMap = {};
    let nextIndex = 0;

    const chartData = currentApiData.map(item => {
        const appName = item[selectedMetric];
        const provinceName = item[config.keyColumn];
        const geoName = reverseNameMapping[provinceName] || provinceName;
        const isAcehFinancial = datasetKey === 'financial' && (provinceName === 'Aceh' || geoName === 'Aceh');

        if (appName && !isAcehFinancial) {
            if (!(appName in appIndexMap)) appIndexMap[appName] = nextIndex++;
            return {
                name: geoName,
                appName,
                value: appIndexMap[appName],
                logoUrl: `/static/logos/${appName}.png`
            };
        }
        // Aceh (financial) gets sentinel -1 to appear in legend; other missing remain null
        return { name: geoName, appName: null, value: isAcehFinancial ? -1 : null };
    });

    // Generate dataClasses for legend (one per fintech app)
    const dataClasses = Object.entries(appIndexMap).map(([appName, idx]) => ({
        from: idx,
        to: idx,
        color: appColors[appName] || '#757575',
        name: appName
    }));

    if (datasetKey === 'financial') {
        // Legend item for Aceh only
        dataClasses.push({
            from: -1,
            to: -1,
            color: '#E0E0E0',
            name: 'Data Tidak Tersedia'
        });
    }

    Highcharts.mapChart(containerId, {
        chart: {
            map: mapData,
            backgroundColor: '#ffffff',
            style: { fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif' },
            events: { load: function () { attachNavigationEnhancements(this); } }
        },
        credits: { enabled: false }, // Disable Highcharts.com credit
        exporting: {
            buttons: { contextButton: { align: 'right', verticalAlign: 'bottom', y: -10 } }
        },
        title: {
            text: `${config.titlePrefix}: ${metricDetails.label}`,
            align: 'right',
            style: { fontSize: '1.5rem', fontWeight: '700', color: '#2d3748' }
        },
        subtitle: {
            text: 'Sumber data: Gelarrasa (Simulasi)',
            align: 'right',
            style: { fontSize: '0.95rem', color: '#718096' }
        },
        legend: {
            // Hapus title untuk tampilan lebih bersih
            layout: 'horizontal',
            align: 'center',
            verticalAlign: 'bottom',
            floating: false,
            itemStyle: { fontSize: '0.75rem' },
            symbolRadius: 6,
            padding: 8,
            backgroundColor: 'rgba(255,255,255,0.85)',
            borderRadius: 8
        },
        mapNavigation: {
            enabled: true,
            buttonOptions: {
                verticalAlign: 'bottom',
                theme: {
                    fill: 'rgba(255,255,255,0.9)',
                    stroke: '#e2e8f0',
                    'stroke-width': 2,
                    r: 8,
                    style: { color: '#2d3748', fontWeight: '600' },
                    states: {
                        hover: { fill: '#667eea', style: { color: '#ffffff' } },
                        select: { fill: '#667eea', style: { color: '#ffffff' } }
                    }
                }
            }
        },
        plotOptions: {
            series: {
                cursor: 'pointer',
                point: {
                    events: {
                        click: function () {
                            const mv = this.series.chart.mapView;
                            if (!mv) return;
                            if (typeof this.zoomTo === 'function') { this.zoomTo(60, { duration: 800, easing: 'easeOutCubic' }); return; }
                            if (this.bounds) mv.fitToBounds(this.bounds, { padding: 60, animation: { duration: 800, easing: 'easeOutCubic' } });
                        }
                    }
                }
            }
        },
        colorAxis: {
            // Use dataClasses for categorical legend
            dataClasses,
            nullColor: '#E0E0E0'
        },
        tooltip: {
            useHTML: true,
            backgroundColor: 'rgba(255,255,255,0.98)',
            borderColor: '#e2e8f0',
            borderRadius: 12,
            borderWidth: 1,
            style: { fontSize: '0.95rem' },
            formatter: function () {
                const geoProvinceName = this.point.name;
                const csvProvinceName = reverseNameMapping[geoProvinceName] || geoProvinceName;
                const provinceData = currentApiData.find(d => d[config.keyColumn] === csvProvinceName);
                if (!provinceData) return `<b>${geoProvinceName}</b><br/><em style="color:#999;">Data tidak tersedia</em>`;
                const appName = provinceData[selectedMetric];
                if (!appName) {
                    return `<div style="padding:12px;min-width:220px;font-family:Inter,sans-serif;">
						<div style="font-weight:700;margin-bottom:10px;font-size:1.05rem;color:#2d3748;">${provinceData[config.keyColumn]}</div>
						<div style="color:#a0aec0;font-size:0.875rem;">Data tidak tersedia</div>
					</div>`;
                }
                const percentage = provinceData.fintech_percentage || 0;
                const logoUrl = `/static/logos/${appName}.png`;
                return `<div style="padding:12px;min-width:220px;font-family:Inter,sans-serif;">
					<div style="font-weight:700;margin-bottom:10px;font-size:1.05rem;color:#2d3748;">${provinceData[config.keyColumn]}</div>
					<div style="display:flex;align-items:center;gap:12px;">
						<img src="${logoUrl}" style="width:48px;height:48px;object-fit:contain;background:#fff;border:2px solid #e2e8f0;border-radius:10px;padding:6px;" onerror="this.style.display='none'" />
						<div>
							<div style="font-weight:600;color:#2d3748;font-size:1rem;">${appName}</div>
							<div style="color:#718096;font-size:0.875rem;margin-top:2px;">Pengguna: <b style="color:#667eea;">${percentage}%</b></div>
						</div>
					</div>
				</div>`;
            }
        },
        series: [{
            data: chartData,
            joinBy: ['PROVINSI', 'name'],
            name: metricDetails.label,
            nullColor: '#E0E0E0',
            dataLabels: { enabled: false },
            states: { hover: { brightness: 0.15, borderColor: '#667eea', borderWidth: 2.5 } },
            borderColor: '#FFFFFF',
            borderWidth: 1.5
        }]
    });
}


--- Dashboard_temp/app/static/js/components/map/config.js ---

export const GEOJSON_URL = '/static/indonesia-38-provinsi.geojson';

export const provinceNameMapping = {
    "Nanggroe Aceh Darusalam": "Aceh",
    "DI Yogyakarta": "Daerah Istimewa Yogyakarta",
    "DKI Jakarta": "DKI Jakarta"
};

export const reverseNameMapping = Object.fromEntries(
    Object.entries(provinceNameMapping).map(([csv, geo]) => [geo, csv])
);

// Colors for fintech app logos (pattern map)
export const appColors = {
    Dana: '#118EEA',
    OVO: '#4C3494',
    GoPay: '#00AA13',
    ShopeePay: '#FF6A3D',
    LinkAja: '#C92A2A',
    Kredivo: '#B33A1C',
    Akulaku: '#FF866B'
};

export const datasetsConfig = {
    regional: {
        endpoint: '/api/data',
        titlePrefix: 'Indikator Ekonomi Regional',
        keyColumn: 'provinsi',
        metrics: {
            outstanding_pinjaman_miliar: { label: 'Outstanding Pinjaman (Rp miliar)', vizType: 'choropleth', type: 'logarithmic', minColor: '#FFF5E6', maxColor: '#FF6B35' },
            dana_diberikan_miliar: { label: 'Jumlah Dana Diberikan (Rp miliar)', vizType: 'choropleth', type: 'logarithmic', minColor: '#E8F5E9', maxColor: '#2E7D32' },
            rekening_penerima_aktif: { label: 'Rekening Penerima Pinjaman Aktif', vizType: 'choropleth', type: 'logarithmic', minColor: '#F0F9FF', maxColor: '#0C4A6E' },
            twp_90: { label: 'TWP 90 (%)', vizType: 'choropleth', type: 'linear', minColor: '#FCE4EC', maxColor: '#C62828' },
            pdrb_ribu_rp: { label: 'PDRB (Ribu Rp)', vizType: 'choropleth', type: 'logarithmic', minColor: '#5DE2E7', maxColor: '#6A0DAD' },
            urbanisasi_persen: { label: 'Tingkat Urbanisasi (%)', vizType: 'choropleth', type: 'linear', minColor: '#FFF3E0', maxColor: '#EF6C00' },
            jumlah_penduduk_ribu: { label: 'Jumlah Penduduk (Ribu Jiwa)', vizType: 'choropleth', type: 'logarithmic', minColor: '#E0F2F1', maxColor: '#00695C' }
        }
    },
    financial: {
        endpoint: '/api/financial-profile',
        titlePrefix: 'Profil Finansial Gen Z',
        keyColumn: 'provinsi',
        metrics: {
            financial_balance: {
                label: 'Status Keuangan (Surplus/Defisit)',
                vizType: 'choropleth',
                dataClasses: [
                    { to: -0.01, color: '#C62828', name: 'Defisit' },
                    { from: 0, color: '#1565C0', name: 'Surplus' }
                ],
                nullColor: '#E0E0E0'
            },
            avg_anxiety_score: { label: 'Rata-rata Skor Kecemasan Finansial', vizType: 'choropleth', type: 'linear', minColor: '#FCE4EC', maxColor: '#C62828' },
            avg_digital_time: { label: 'Rata-rata Waktu Digital Harian (Jam)', vizType: 'choropleth', type: 'linear', minColor: '#E3F2FD', maxColor: '#1565C0' },
            mode_fintech_app: { label: 'Fintech Populer (Logo)', vizType: 'pattern' }
        }
    }
};


--- Dashboard_temp/app/static/js/components/map/choroplethRenderer.js ---

import { attachNavigationEnhancements } from './navigation.js';

export function renderChoroplethMap({
    mapData,
    currentApiData,
    config,
    metricDetails,
    reverseNameMapping,
    selectedMetric,
    datasetKey,
    containerId = 'container'
}) {
    if (!currentApiData || !mapData) return;
    const allProvinces = mapData.features.map(f => f.properties.PROVINSI);
    const chartData = allProvinces.map(geoName => {
        const csvProvinceName = reverseNameMapping[geoName] || geoName;
        const item = currentApiData.find(d => d[config.keyColumn] === csvProvinceName);
        let value = null;
        if (item) value = item[selectedMetric] != null ? parseFloat(item[selectedMetric]) : null;

        const isAcehFinancial = datasetKey === 'financial' && (geoName === 'Aceh' || csvProvinceName === 'Aceh');
        const isFinancialBalance = datasetKey === 'financial' && selectedMetric === 'financial_balance';

        // Aceh only gets sentinel -1 for Status Keuangan to appear in legend
        const finalValue = (isAcehFinancial && isFinancialBalance) ? -1 : (isAcehFinancial ? null : value);

        return {
            name: geoName,
            value: finalValue,
            color: (finalValue === null || finalValue === -1) ? '#E0E0E0' : undefined
        };
    });
    const colorAxisOptions = metricDetails.dataClasses
        ? (() => {
            const isFinancialBalance = datasetKey === 'financial' && selectedMetric === 'financial_balance';
            const dc = [...metricDetails.dataClasses];
            if (isFinancialBalance) {
                dc.push({ from: -1, to: -1, color: '#E0E0E0', name: 'Data Tidak Tersedia' });
            }
            return { dataClasses: dc };
        })()
        : {
            type: metricDetails.type,
            // Override khusus per metrik
            ...(selectedMetric === 'pdrb_ribu_rp'
                ? { min: 10000, max: 1000000 }
                : selectedMetric === 'rekening_penerima_aktif'
                    ? { min: 1000, max: 10000000 }
                    : selectedMetric === 'jumlah_penduduk_ribu'
                        ? { min: 100, max: 100000 }
                        : { min: metricDetails.type === 'logarithmic' ? 1 : null }),
            minColor: metricDetails.minColor,
            maxColor: metricDetails.maxColor,
            labels: {
                formatter: function () { return this.value ? this.value.toLocaleString('id-ID') : 'N/A'; },
                style: { fontSize: '0.875rem', color: '#4a5568' }
            }
        };

    Highcharts.mapChart(containerId, {
        chart: {
            map: mapData,
            backgroundColor: '#ffffff',
            style: { fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif' },
            events: { load: function () { attachNavigationEnhancements(this); } }
        },
        credits: { enabled: false }, // Disable Highcharts.com credit
        exporting: { buttons: { contextButton: { align: 'right', verticalAlign: 'bottom', y: -10 } } },
        title: {
            text: `${config.titlePrefix}: ${metricDetails.label}`,
            align: 'right',
            style: { fontSize: '1.5rem', fontWeight: '700', color: '#2d3748' }
        },
        mapNavigation: {
            enabled: true,
            buttonOptions: {
                verticalAlign: 'bottom',
                theme: {
                    fill: 'rgba(255,255,255,0.9)',
                    stroke: '#e2e8f0',
                    'stroke-width': 2,
                    r: 8,
                    style: { color: '#2d3748', fontWeight: '600' },
                    states: {
                        hover: { fill: '#667eea', style: { color: '#ffffff' } },
                        select: { fill: '#667eea', style: { color: '#ffffff' } }
                    }
                }
            }
        },
        plotOptions: {
            series: {
                cursor: 'pointer',
                point: {
                    events: {
                        click: function () {
                            const mv = this.series.chart.mapView;
                            if (!mv) return;
                            if (typeof this.zoomTo === 'function') { this.zoomTo(60, { duration: 1000, easing: 'easeOutCubic' }); return; }
                            if (this.bounds) mv.fitToBounds(this.bounds, { padding: 60, animation: { duration: 1000, easing: 'easeOutCubic' } });
                        }
                    }
                }
            }
        },
        colorAxis: colorAxisOptions,
        series: [{
            data: chartData,
            joinBy: ['PROVINSI', 'name'],
            name: metricDetails.label,
            nullColor: metricDetails.nullColor || '#E0E0E0',
            borderColor: '#ffffff',
            borderWidth: 1.5,
            states: { hover: { color: '#667eea', borderColor: '#ffffff', brightness: 0.1 } },
            tooltip: {
                headerFormat: '<span></span>',
                backgroundColor: 'rgba(255,255,255,0.98)',
                borderColor: '#e2e8f0',
                borderRadius: 12,
                borderWidth: 1,
                style: { fontSize: '0.95rem', fontWeight: '500' },
                pointFormatter: function () {
                    const geoProvinceName = this.name;
                    const csvProvinceName = reverseNameMapping[geoProvinceName] || geoProvinceName;
                    const provinceData = currentApiData.find(d => d[config.keyColumn] === csvProvinceName);
                    if (!provinceData || provinceData[selectedMetric] == null) return `<b>${geoProvinceName}</b><br/><em style="color:#999;">Data tidak tersedia</em>`;
                    let out = `<b>${provinceData[config.keyColumn]}</b><br/>`;
                    if (selectedMetric === 'financial_balance') {
                        const balance = provinceData.financial_balance;
                        const income = provinceData.avg_income;
                        const expense = provinceData.avg_expense;
                        const status = balance >= 0 ? '<span style="color:#1565C0;font-weight:bold;">Surplus</span>' : '<span style="color:#C62828;font-weight:bold;">Defisit</span>';
                        out += `Status Keuangan: ${status}<br/>--------------------<br/>Pendapatan: <b>Rp ${income?.toLocaleString('id-ID') || 'N/A'}</b><br/>Pengeluaran: <b>Rp ${expense?.toLocaleString('id-ID') || 'N/A'}</b>`;
                    } else {
                        const v = provinceData[selectedMetric];
                        const formatted = v != null ? parseFloat(v).toLocaleString('id-ID') : 'N/A';
                        let display = `<b>${formatted}</b>`;
                        if (['avg_income', 'avg_expense'].includes(selectedMetric)) display = `<b>Rp ${formatted}</b>`;
                        else if (selectedMetric === 'avg_digital_time') display = `<b>${formatted} jam</b>`;
                        out += `${metricDetails.label}: ${display}`;
                    }
                    return out;
                }
            }
        }]
    });
}


--- Dashboard_temp/app/static/js/components/map/app.js ---

import { datasetsConfig, GEOJSON_URL, reverseNameMapping } from './config.js';
import { fetchApiData, fetchGeoJSON } from './api.js';
import { renderChoroplethMap } from './choroplethRenderer.js';
import { renderPatternMap } from './patternRenderer.js';

document.addEventListener('DOMContentLoaded', async function () {
    const datasetDropdown = document.getElementById('map-dataset-dropdown');
    const metricDropdown = document.getElementById('map-metric-dropdown');
    const container = document.getElementById('container');

    const state = {
        currentApiData: [],
        mapData: null,
        selectedDataset: 'regional',
        selectedMetric: null
    };

    function initDropdown(dropdownEl, onSelect) {
        const selected = dropdownEl.querySelector('.dropdown-selected');
        const options = dropdownEl.querySelector('.dropdown-options');

        selected.addEventListener('click', () => {
            dropdownEl.classList.toggle('open');
        });

        options.addEventListener('click', (e) => {
            if (e.target.tagName === 'LI') {
                const value = e.target.dataset.value;
                const text = e.target.textContent;
                selected.textContent = text + ' â–¼';
                dropdownEl.classList.remove('open');
                onSelect(value);
            }
        });

        document.addEventListener('click', (e) => {
            if (!dropdownEl.contains(e.target)) {
                dropdownEl.classList.remove('open');
            }
        });
    }

    function updateMetricSelector(datasetKey) {
        const config = datasetsConfig[datasetKey];
        const metricOptions = metricDropdown.querySelector('.dropdown-options');
        const metricSelected = metricDropdown.querySelector('.dropdown-selected');
        
        metricOptions.innerHTML = '';
        
        let firstMetric = null;

        for (const [value, details] of Object.entries(config.metrics)) {
            if (!firstMetric) {
                firstMetric = { value, label: details.label };
            }
            const li = document.createElement('li');
            li.dataset.value = value;
            li.textContent = details.label;
            metricOptions.appendChild(li);
        }

        // Select the first metric by default
        if (firstMetric) {
            state.selectedMetric = firstMetric.value;
            metricSelected.textContent = firstMetric.label + ' â–¼';
        }
    }

    async function loadDataset(datasetKey) {
        try {
            state.currentApiData = await fetchApiData(datasetsConfig[datasetKey].endpoint);
        } catch (err) {
            console.error('Gagal memuat data API:', err);
            container.innerHTML = `<p style="color:red; text-align:center;">Gagal memuat data.</p>`;
        }
    }

    function renderMap() {
        if (!state.currentApiData || !state.mapData) return;
        
        const config = datasetsConfig[state.selectedDataset];
        const metricDetails = config.metrics[state.selectedMetric];

        const common = {
            mapData: state.mapData,
            currentApiData: state.currentApiData,
            config,
            metricDetails,
            reverseNameMapping,
            selectedMetric: state.selectedMetric,
            datasetKey: state.selectedDataset,
            containerId: 'container'
        };

        if (metricDetails.vizType === 'pattern') {
            renderPatternMap(common);
        } else {
            renderChoroplethMap(common);
        }
    }

    async function initializeApp() {
        try {
            state.mapData = await fetchGeoJSON(GEOJSON_URL);

            initDropdown(datasetDropdown, async (selectedValue) => {
                state.selectedDataset = selectedValue;
                updateMetricSelector(selectedValue);
                await loadDataset(selectedValue);
                renderMap();
            });

            initDropdown(metricDropdown, (selectedValue) => {
                state.selectedMetric = selectedValue;
                renderMap();
            });

            // Initial setup
            updateMetricSelector(state.selectedDataset);
            await loadDataset(state.selectedDataset);
            renderMap();

        } catch (error) {
            console.error('Inisialisasi aplikasi gagal:', error);
            container.innerHTML = `<p style="color:red; text-align:center;">Gagal memuat peta atau data awal.</p>`;
        }
    }

    initializeApp();
});

--- Dashboard_temp/app/static/js/components/lightbulb-animation.js ---

// Lightbulb animation
function initLightbulbAnimation() {
    const bulbGlass = document.querySelector("#bulb-glass");
    const bulbRays = document.querySelector("#bulb-rays");

    if (!bulbGlass || !bulbRays) {
        console.warn('Lightbulb elements not found, skipping animation');
        return;
    }

    const bulbTl = gsap.timeline({ repeat: -1, yoyo: true, repeatDelay: 1 });
    bulbTl.to(bulbGlass, { fillOpacity: 0.6, duration: 0.5 })
        .to(bulbRays, { opacity: 1, scale: 1.1, transformOrigin: 'center center', duration: 0.5 }, "<")
        .to("#bulb-rays line", {
            attr: {
                x2: (i, t) => parseFloat(t.getAttribute('x1')) + (Math.random() - 0.5) * 5,
                y2: (i, t) => parseFloat(t.getAttribute('y1')) + (Math.random() - 0.5) * 5
            },
            duration: 1,
            stagger: 0.1
        }, "<");
}


--- Dashboard_temp/app/static/js/components/dropdown-animation.js ---

function initDropdownAnimation() {
    const dropdown = document.querySelector('.custom-dropdown');
    if (!dropdown) return;

    const selected = dropdown.querySelector('.dropdown-selected');
    const options = dropdown.querySelector('.dropdown-options');

    // Wrap initial text in a span for animation
    selected.innerHTML = `<span>${selected.textContent}</span>`;

    // GSAP timeline for the dropdown opening
    const tl = gsap.timeline({
        paused: true,
        onReverseComplete: () => {
            // Explicitly set pointerEvents to none when closed
            gsap.set(options, { pointerEvents: 'none' });
        }
    });
    tl.fromTo(options,
        { opacity: 0, y: 10, pointerEvents: 'none' },
        {
            opacity: 1,
            y: 0,
            pointerEvents: 'auto',
            duration: 0.3,
            ease: 'power2.out'
        }
    );

    // Hover animation for the selected item
    selected.addEventListener('mouseenter', () => {
        gsap.to(selected, {
            scale: 1.05,
            duration: 0.3,
            ease: 'power2.out'
        });
    });

    selected.addEventListener('mouseleave', () => {
        gsap.to(selected, {
            scale: 1,
            duration: 0.3,
            ease: 'power2.out'
        });
    });

    selected.addEventListener('click', () => {
        dropdown.classList.toggle('open');
        if (dropdown.classList.contains('open')) {
            tl.play();
        } else {
            tl.reverse();
        }
    });

    options.addEventListener('click', (e) => {
        if (e.target.tagName === 'LI') {
            const newValue = e.target.textContent;
            const textSpan = selected.querySelector('span');

            if (textSpan && textSpan.textContent !== newValue) {
                if (gsap.isTweening(textSpan)) return;

                const animTl = gsap.timeline();
                animTl.to(textSpan, {
                    opacity: 0,
                    y: -10,
                    duration: 0.2,
                    ease: 'power2.in'
                })
                    .add(() => {
                        textSpan.textContent = newValue + ' â–¼';
                    })
                    .to(textSpan, {
                        opacity: 1,
                        y: 0,
                        duration: 0.3,
                        ease: 'power2.out'
                    });
            }

            selected.dataset.value = e.target.dataset.value;
            dropdown.classList.remove('open');
            tl.reverse();
            document.dispatchEvent(new CustomEvent('filterChanged', { detail: { filterBy: e.target.dataset.value } }));
        }
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
            if (dropdown.classList.contains('open')) {
                dropdown.classList.remove('open');
                tl.reverse();
            }
        }
    });
}


--- Dashboard_temp/app/static/js/components/loan_panel.js ---

// static/js/components/loan_panel.js

/**
 * A helper function to read a CSS variable value from the root element.
 * @param {string} variable - The name of the CSS variable (e.g., '--chart-income').
 * @returns {string} The computed value of the variable.
 */
function getCssVariable(variable) {
    return getComputedStyle(document.documentElement).getPropertyValue(variable).trim();
}

function formatCurrency(amount) {
    if (!amount || amount === 0) return 'Rp 0';
    if (amount >= 1000000000) return `Rp ${(amount / 1000000000).toFixed(1)}B`;
    if (amount >= 1000000) return `Rp ${(amount / 1000000).toFixed(1)}M`;
    if (amount >= 1000) return `Rp ${(amount / 1000).toFixed(1)}K`;
    return `Rp ${amount.toFixed(0)}`;
}

function updateKPICard(elementId, value) {
    const element = document.getElementById(elementId);
    if (element) element.textContent = value;
}

function renderLoanChart(data) {
    const chartDiv = document.getElementById('loan-overview-chart');
    if (!chartDiv) return;

    const distribution = data.distribution || [];
    const categories = distribution.map(d => d.category);
    const percentages = distribution.map(d => d.percentage);
    const counts = distribution.map(d => d.count);

    // MODIFIED: Colors are now read from CSS variables
    const colorMapping = {
        'No Loan': getCssVariable('--chart-loan-no-loan'),
        '<5M': getCssVariable('--chart-loan-tier-1'),
        '5M-10M': getCssVariable('--chart-loan-tier-2'),
        '10M-15M': getCssVariable('--chart-loan-tier-3'),
        '>15M': getCssVariable('--chart-loan-tier-4')
    };
    const colors = categories.map(cat => colorMapping[cat] || '#95a5a6');

    const totalWithLoans = distribution.filter(d => d.category !== 'No Loan').reduce((sum, d) => sum + d.count, 0);
    const filterText = data.filter_applied && data.filter_applied !== 'All' ? ` (${totalWithLoans} borrowers in ${data.filter_applied})` : ` (${totalWithLoans} borrowers)`;
    const centerText = data.filter_applied && data.filter_applied !== 'All' ? `<b style="font-size:12px">${data.with_loan}</b><br><span style='font-size:8px;color:#7f8c8d'>with loans</span><br><span style='font-size:8px;color:#95a5a6'>in ${data.filter_applied}</span>` : `<b style="font-size:12px">${data.with_loan}</b><br><span style='font-size:8px;color:#7f8c8d'>with loans</span>`;

    const chartData = [{
        labels: categories,
        values: percentages,
        hole: 0.60,
        type: 'pie',
        marker: { colors: colors, line: { color: '#ffffff', width: 2 } },
        textposition: 'outside',
        textfont: { size: 11, color: '#2c3e50', family: 'Outfit, sans-serif' },
        hovertemplate: '<b>%{label}</b><br>%{value:.1f}% (%{customdata} people)<extra></extra>',
        customdata: counts,
        direction: 'clockwise',
        sort: false
    }];

    const layout = {
        title: { text: `<b>ðŸ’³ Outstanding Loan<br>Distribution${filterText}</b>`, x: 0.5, xanchor: 'center', font: { size: 8, color: '#2c3e50', family: 'Outfit, sans-serif' } },
        annotations: [{ text: centerText, x: 0.5, y: 0.5, font: { size: 7, family: 'Outfit, sans-serif' }, showarrow: false }],
        showlegend: false,
        legend: { orientation: 'h', x: 0.5, xanchor: 'center', y: -0.08, yanchor: 'top', font: { size: 7, family: 'Outfit, sans-serif' } },
        margin: { l: 15, r: 42, t: 33, b: 0 },
        paper_bgcolor: 'white',
        height: 120, width: 120,
        template: 'plotly_white'
    };

    Plotly.newPlot(chartDiv, chartData, layout, { displayModeBar: false, responsive: true });
}

// NOTE: Loan Purpose chart colors are already dynamic from the backend, so no changes are needed here.
function renderLoanPurposeChart(data, category) {
    const chartDiv = document.getElementById('loan-purpose-chart');
    if (!chartDiv) return;

    if (!data || data.length === 0) {
        chartDiv.innerHTML = `<div class="placeholder-content"><i class="fas fa-info-circle fa-2x text-muted"></i><h6 class="mt-2">No Loan Purpose Data</h6></div>`;
        return;
    }

    // Clean, consistent labels
    const labels = data.map(d => d.purpose);                 // For pie (no emoji to avoid clutter)
    const purposesWithIcons = data.map(d => `${d.icon} ${d.purpose}`); // For bar
    const counts = data.map(d => d.count);
    const percentages = data.map(d => d.percentage);
    const colors = data.map(d => d.color);
    const totalCount = counts.reduce((a, b) => a + b, 0);
    const titleText = category && category !== 'All' ? `Loan Usage (${totalCount} borrowers in ${category})` : `Loan Usage Purpose (${totalCount} borrowers)`;

    const pieTrace = {
        values: percentages,
        labels: labels,
        type: 'pie',
        // Reduce pie size - smaller domain
        domain: { x: [0, 0.35], y: [0.15, 0.95] },
        marker: { colors: colors, line: { color: '#ffffff', width: 1.5 } },
        textposition: 'outside',
        textinfo: 'label+percent',
        textfont: { size: 9, color: '#2c3e50' },
        automargin: true,
        insidetextorientation: 'auto',
        hovertemplate: '<b>%{label}</b><br>%{value:.1f}%<br>(%{customdata} borrowers)<extra></extra>',
        customdata: counts,
        showlegend: false
    };

    const barTrace = {
        y: purposesWithIcons, x: counts, type: 'bar', orientation: 'h', xaxis: 'x2', yaxis: 'y2',
        marker: { color: colors, line: { color: '#ffffff', width: 1 } },
        text: counts.map(c => `${c}`), textposition: 'outside', textfont: { size: 7 },
        hovertemplate: '<b>%{y}</b><br>Count: %{x}<extra></extra>', width: 0.6
    };

    const layout = {
        title: { text: `<b>ðŸŽ¯ ${titleText}</b>`, x: 0.5, xanchor: 'center', font: { size: 8 } },
        height: 140, width: 240, template: 'plotly_white', margin: { l: 48, r: 12, t: 30, b: 0 }, showlegend: false,
        xaxis2: { domain: [0.50, 1], anchor: 'y2', showgrid: true, range: [0, Math.max(...counts) * 1.15], tickfont: { size: 7 } },
        yaxis2: { domain: [0, 1], anchor: 'x2', autorange: 'reversed', showgrid: false, tickfont: { size: 7 } }
    };

    Plotly.newPlot(chartDiv, [pieTrace, barTrace], layout, { displayModeBar: false, responsive: true });
}

function updateLoanPanel(category) {
    const categoryParam = category || 'All';
    fetch(`/api/loan-filtered/${encodeURIComponent(categoryParam)}`)
        .then(response => response.json())
        .then(data => {
            updateKPICard('loan-total-value', data.with_loan);
            updateKPICard('loan-total-subtext', `${data.with_loan_pct}% of ${data.total_respondents} respondents`);
            updateKPICard('loan-avg-value', formatCurrency(data.mean));
            updateKPICard('loan-third-label', 'Total Outstanding');
            updateKPICard('loan-third-value', formatCurrency(data.total_outstanding));
            updateKPICard('loan-third-subtext', category && category !== 'All' ? `In ${category}` : 'Sum of all loans');
            updateKPICard('loan-max-value', formatCurrency(data.max));
            renderLoanChart(data);
        });
}

function updateLoanPurposeChart(category) {
    const categoryParam = category || 'All';
    fetch(`/api/loan-purpose/${encodeURIComponent(categoryParam)}`)
        .then(response => response.json())
        .then(data => renderLoanPurposeChart(data, category));
}

function initializeLoanCharts() {
    updateLoanPanel(null);
    updateLoanPurposeChart(null);
}

--- Dashboard_temp/app/static/js/components/hero-charts.js ---

function initHeroCharts() {
    initAnxietyFaceAnimation();
    initAnxietyBarChart();
}


--- Dashboard_temp/app/static/js/components/header-title-animation.js ---

// Animate the header title
function initHeaderTitleAnimation() {
    const chars = gsap.utils.toArray('.title-char');
    const accent = document.querySelector('.title-accent');
    const title = document.querySelector('.gen-z-title');
    const container = document.querySelector('.logo-container');

    // Check if elements exist before animating
    if (!title || !container || chars.length === 0 || !accent) {
        console.warn('Header title elements not found, skipping animation');
        return;
    }

    // Initial entrance animation
    const tl = gsap.timeline({ delay: 0.3 });

    tl.from(chars, {
        y: -50,
        opacity: 0,
        scale: 0.5,
        rotation: -15,
        duration: 0.8,
        ease: "back.out(2)",
        stagger: {
            each: 0.05,
            from: "start"
        }
    })
        .from(accent, {
            scaleX: 0,
            duration: 0.6,
            ease: "power3.out"
        }, "-=0.3");


    container.addEventListener('mousemove', (e) => {
        const rect = container.getBoundingClientRect();
        mouse.x = e.clientX - rect.left - rect.width / 2;
        mouse.y = e.clientY - rect.top - rect.height / 2;

        gsap.to(titlePos, {
            x: mouse.x * 0.15,
            y: mouse.y * 0.15,
            duration: 0.6,
            ease: "power2.out",
            onUpdate: () => {
                gsap.set(title, {
                    x: titlePos.x,
                    y: titlePos.y
                });
            }
        });
    });

    container.addEventListener('mouseleave', () => {
        gsap.to(titlePos, {
            x: 0,
            y: 0,
            duration: 0.8,
            ease: "elastic.out(1, 0.5)",
            onUpdate: () => {
                gsap.set(title, {
                    x: titlePos.x,
                    y: titlePos.y
                });
            }
        });
    });

    // Individual character hover interactions
    chars.forEach((char, i) => {
        char.addEventListener('mouseenter', () => {
            gsap.to(char, {
                scale: 1.3,
                rotation: gsap.utils.random(-15, 15),
                y: -10,
                color: i % 3 === 0 ? '#FF6B9D' : i % 3 === 1 ? '#5DADE2' : '#9B59B6',
                duration: 0.3,
                ease: "back.out(2)"
            });

            // Create ripple effect on neighbors
            const neighbors = [chars[i - 1], chars[i + 1]].filter(Boolean);
            gsap.to(neighbors, {
                scale: 1.15,
                duration: 0.3,
                ease: "power2.out"
            });
        });

        char.addEventListener('mouseleave', () => {
            gsap.to(char, {
                scale: 1,
                rotation: 0,
                y: 0,
                color: 'transparent',
                duration: 0.4,
                ease: "elastic.out(1, 0.5)"
            });

            const neighbors = [chars[i - 1], chars[i + 1]].filter(Boolean);
            gsap.to(neighbors, {
                scale: 1,
                duration: 0.4,
                ease: "power2.out"
            });
        });
    });



}


--- Dashboard_temp/app/static/js/components/hero-charts/anxiety-face-animation.js ---

function initAnxietyFaceAnimation() {
    // 1. Get all the necessary DOM elements.
    const elements = getFaceAnimationElements();
    if (!elements) return;

    // 2. Get the target score from the data attribute.
    const parsedScore = parseFloat(elements.anxietyScoreEl.getAttribute('data-score') || '0');
    const targetScore = isNaN(parsedScore) ? 3.2 : parsedScore;

    // 3. MODIFIED: We no longer create a timeline here.
    // Instead, we pass the data the observer needs to trigger the animation itself.
    setupFaceAnimationObservers(elements, targetScore);
}

--- Dashboard_temp/app/static/js/components/hero-charts/anxiety-face-animation/elements.js ---

function getFaceAnimationElements() {
    // 1. This function gets all the DOM elements needed for the face animation.
    const elements = {
        anxietyContainer: document.getElementById('anxiety-container'),
        anxietyScoreEl: document.getElementById('avgAnxietyScore'),
        anxietyGaugeFill: document.getElementById('anxiety-gauge-fill'),
        // MODIFIED: Replaced SVG elements with the new emoji container
        emojiContainer: document.getElementById('anxiety-emoji')
    };

    // 2. Check if all elements are present.
    for (const key in elements) {
        if (!elements[key] || (elements[key] instanceof NodeList && elements[key].length === 0)) {
            console.error(`Missing required element for anxiety face animation: ${key}`);
            return null;
        }
    }

    // 3. Return the elements object.
    return elements;
}

--- Dashboard_temp/app/static/js/components/hero-charts/anxiety-face-animation/observers.js ---

// MODIFIED: The function now accepts 'targetScore' instead of 'animationTimeline'.
function setupFaceAnimationObservers(elements, targetScore) {
    const { anxietyContainer } = elements;
    let hasPlayed = false;

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            // When the element is intersecting and the animation hasn't played yet...
            if (entry.isIntersecting && !hasPlayed) {
                hasPlayed = true;

                // MODIFIED: ...directly call the function that starts our animation.
                // This replaces the old 'animationTimeline.play()'
                createFaceAnimation(elements, targetScore);

                // We can also unobserve now to save resources.
                observer.unobserve(anxietyContainer);
            }
        });
    }, { threshold: 0.3 });

    observer.observe(anxietyContainer);

    // Set up the hover animations.
    const hoverAnimation = createHoverAnimation(elements);
    anxietyContainer.addEventListener('mouseenter', hoverAnimation.onMouseEnter);
    anxietyContainer.addEventListener('mouseleave', hoverAnimation.onMouseLeave);
}

--- Dashboard_temp/app/static/js/components/hero-charts/anxiety-face-animation/animations.js ---

// Helper function remains to define the rules.
function getEmojiForScore(score) {
    if (score <= 2.7) return 'ðŸ™‚';
    if (score <= 3.0) return 'ðŸ¥²';
    if (score <= 3.2) return 'ðŸ˜¥';
    return 'ðŸ˜­';
}

// This helper is now a clean, stateless utility.
function performEmojiTransition(element, newEmoji) {
    if (!element || element.textContent === newEmoji) return;

    gsap.to(element, {
        scale: 0,
        opacity: 0,
        duration: 0.3,
        ease: 'power2.in',
        onComplete: () => {
            element.textContent = newEmoji;
            gsap.fromTo(element,
                { scale: 0, opacity: 0 },
                { scale: 1, opacity: 1, duration: 0.4, ease: 'back.out(2)' }
            );
        }
    });
}

// MODIFIED: This function no longer needs to do anything with timelines.
// It is now the one-time trigger for the initial animation.
function createFaceAnimation(elements, targetScore) {
    // 1. Set the initial emoji state immediately before animating.
    if (elements.emojiContainer) {
        elements.emojiContainer.textContent = getEmojiForScore(0);
    }

    // 2. Call the master animation controller with the slow startup duration.
    updateAnxietyGauge(targetScore, 2.6);
}

// The hover animation remains unchanged.
function createHoverAnimation(elements) {
    const { emojiContainer } = elements;
    if (!emojiContainer) return { onMouseEnter: () => { }, onMouseLeave: () => { } };

    return {
        onMouseEnter: () => {
            gsap.to(emojiContainer, {
                scale: 1.2,
                duration: 0.3,
                ease: 'back.out(2)'
            });
        },
        onMouseLeave: () => {
            gsap.to(emojiContainer, {
                scale: 1,
                duration: 0.5,
                ease: 'elastic.out(1, 0.5)'
            });
        }
    };
}

--- Dashboard_temp/app/static/js/components/hero-charts/anxiety-bar-chart.js ---

function initAnxietyBarChart() {
    // 1. Get the chart container element from the HTML.
    const anxietyBarChartEl = document.getElementById('anxietyBarChart');

    // 2. If the container doesn't exist, we can't create the chart.
    if (!anxietyBarChartEl) {
        console.error("Missing required element for anxiety bar chart: #anxietyBarChart");
        return;
    }

    // 3. Define the state of the chart.
    const state = {
        selectedFilter: null, // {category, value, pointIndex}
        currentFilterCategory: 'employment_status', // Default category
    };

    // 4. Get the chart configuration.
    const chartConfig = getChartConfig();

    // 5. Create the Highcharts chart instance.
    const chart = Highcharts.chart('anxietyBarChart', chartConfig);

    // 6. Attach state and colors to the chart object to be accessible by event handlers.
    chart.state = state;

    // 7. Load the chart with the default filter.
    updateChart(chart, state, 'employment_status');

    // 8. Listen for a custom event to change the chart filter.
    document.addEventListener('filterChanged', (e) => {
        updateChart(chart, state, e.detail.filterBy);
    });

    // 9. Animate the chart's entrance for a nice visual effect.
    gsap.from(anxietyBarChartEl, {
        duration: 1,
        scale: 0.5,
        opacity: 0,
        delay: 0.5,
        ease: 'back.out(1.7)'
    });
}

--- Dashboard_temp/app/static/js/components/hero-charts/anxiety-bar-chart/chart-data.js ---

// This function now becomes the single source of truth for the gauge animation.
// It accepts a duration to handle both the slow startup and fast updates.
function updateAnxietyGauge(newScore, duration = 1.5) {
    const anxietyScoreEl = document.getElementById('avgAnxietyScore');
    const anxietyGaugeFill = document.getElementById('anxiety-gauge-fill');
    const emojiContainer = document.getElementById('anxiety-emoji');
    if (!anxietyScoreEl || !anxietyGaugeFill || !emojiContainer) return;

    // 1. CRITICAL: Kill any previous animations on these elements to prevent conflicts.
    gsap.killTweensOf([anxietyScoreEl, anxietyGaugeFill, emojiContainer]);

    const currentScore = parseFloat(anxietyScoreEl.textContent) || 0;
    const counter = { val: currentScore };

    // 2. Define thresholds and state for the emoji transition. This resets on every new animation.
    const thresholds = [
        { score: 2.8, emoji: 'ðŸ¥²' },
        { score: 3.1, emoji: 'ðŸ˜¥' },
        { score: 3.3, emoji: 'ðŸ˜­' }
    ];
    let nextThresholdIndex = 0;
    // Find what the next threshold should be based on the starting score.
    while (nextThresholdIndex < thresholds.length && currentScore >= thresholds[nextThresholdIndex].score) {
        nextThresholdIndex++;
    }

    // 3. Animate the score counter. The onUpdate callback now handles everything.
    gsap.to(counter, {
        val: newScore,
        duration: duration,
        ease: "power3.out",
        onUpdate: function () {
            // Update the score text.
            anxietyScoreEl.textContent = counter.val.toFixed(1);

            // Check if the score has passed the next emotional threshold.
            if (nextThresholdIndex < thresholds.length) {
                const nextThreshold = thresholds[nextThresholdIndex];
                if (counter.val >= nextThreshold.score) {
                    performEmojiTransition(emojiContainer, nextThreshold.emoji);
                    nextThresholdIndex++; // Advance to the next threshold.
                }
            }
        }
    });

    // 4. Animate the gauge fill height simultaneously.
    gsap.to(anxietyGaugeFill, {
        height: `${Math.max(0, (newScore - 1) / 4) * 100}%`,
        duration: duration,
        ease: "power1.inOut"
    });

    // 5. Set the final emoji state immediately if there are no thresholds to cross.
    const finalEmoji = getEmojiForScore(newScore);
    if (emojiContainer.textContent !== finalEmoji && thresholds.every(t => newScore < t.score || currentScore >= t.score)) {
        performEmojiTransition(emojiContainer, finalEmoji);
    }
}


// Function to reset all metrics to their original, unfiltered state.
function resetAllData() {
    // Animate all metric cards back to their original scores.
    document.querySelectorAll('[data-original-score]').forEach(el => {
        const originalScore = parseFloat(el.getAttribute('data-original-score'));
        if (!isNaN(originalScore)) {
            if (el.id.startsWith('score')) {
                const counter = { val: parseFloat(el.textContent) || 0 };
                gsap.to(counter, {
                    val: originalScore,
                    duration: 1.5,
                    ease: 'power3.out',
                    onUpdate: () => {
                        el.textContent = Math.round(counter.val);
                    }
                });
            }
        }
    });

    // Reset the main anxiety gauge to its original score using our master function.
    const anxietyScoreEl = document.getElementById('avgAnxietyScore');
    if (anxietyScoreEl) {
        const originalAnxietyScore = parseFloat(anxietyScoreEl.getAttribute('data-original-score'));
        if (!isNaN(originalAnxietyScore)) {
            // Call the unified function with the default (fast) duration.
            updateAnxietyGauge(originalAnxietyScore);
        }
    }
}


// Function to fetch data and update the chart.
function updateChart(chart, state, filterBy) {
    state.currentFilterCategory = filterBy;
    state.selectedFilter = null; // Reset selection when the category changes.

    fetch(`/data/anxiety_by/${filterBy}`)
        .then(response => response.json())
        .then(data => {
            // *** DYNAMIC LOGIC MODIFICATION ***

            const numCategories = data.categories.length;
            const threshold = 6;
            const isBarChart = numCategories <= threshold;

            const newOptions = {
                chart: {
                    type: isBarChart ? 'bar' : 'column'
                },
                xAxis: {
                    labels: {
                        // MODIFIED: Force rotation to 0 to keep labels straight
                        rotation: 0
                    }
                },
                yAxis: {
                    // MODIFIED: Ensure the title is always present for column charts
                    title: {
                        text: isBarChart ? null : ''
                    }
                },
            };

            chart.update(newOptions, false);

            // *** END MODIFICATION ***


            // Generate colors based on the sorted data
            const baseColor = '#5DADE2';
            const numScores = data.scores.length;
            const generatedColors = data.scores.map((_, index) => {
                const brightenAmount = (index / (numScores - 1 || 1)) * 0.6;
                return Highcharts.color(baseColor).brighten(brightenAmount).get();
            });

            chart.generatedColors = generatedColors;

            const processedData = data.scores.map((score, index) => ({
                y: score,
                color: generatedColors[index]
            }));

            chart.xAxis[0].setCategories(data.categories, false);
            chart.series[0].setData(processedData, true);

            resetAllData();
        })
        .catch(error => console.error('Error updating chart:', error));
}

--- Dashboard_temp/app/static/js/components/hero-charts/anxiety-bar-chart/chart-config.js ---

function getChartConfig() {
    // 1. This function returns the configuration object for the Highcharts chart.
    return {
        // 2. Basic chart settings.
        chart: {
            type: 'column',
            backgroundColor: 'transparent',
            // MODIFIED: Increase height so all labels fit
            height: 125

        },
        title: { text: null },
        // 3. X-axis configuration.
        xAxis: {
            categories: [], // To be filled with data later
            title: { text: null },
            labels: {
                step: 1,
                style: { fontSize: '8px', color: '#666' },
                rotation: 0,
                // MODIFIED: Removed the y adjustment; let Highcharts handle default positioning
                y: 0
            },
            lineWidth: 0,
            tickWidth: 0
        },
        // 4. Y-axis configuration.
        yAxis: {
            min: 0,
            max: 4,
            title: { text: null },
            labels: { enabled: false },
            gridLineWidth: 0
        },
        // 5. Tooltip customization.
        tooltip: {
            valueSuffix: ' ',
            formatter: function () {
                return `<b>${this.x}</b><br/>Anxiety Score: ${this.y.toFixed(1)}<br/><i>Click to filter</i>`;
            }
        },
        // 6. Plot options for the series.
        plotOptions: {
            series: {
                animation: { duration: 1000, easing: 'easeOutBounce' },
                cursor: 'pointer',
                point: {
                    events: {
                        // 7. Pass the click handler function to the chart configuration.
                        click: chartClickHandler
                    }
                }
            },
            // 8. Define options for BOTH column and bar types
            column: {
                dataLabels: {
                    enabled: true,
                    format: '{y:.1f}',
                    style: {
                        fontSize: '9px',
                        color: '#333',
                        textOutline: 'none'
                    },
                    // Keep labels above the bar even for tall columns
                    inside: false,
                    crop: false,
                    overflow: 'allow',
                    y: -6
                },
                borderRadius: 4,
                borderWidth: 0
            },
            bar: {
                dataLabels: {
                    enabled: true,
                    format: '{y:.1f}',
                    style: {
                        fontSize: '11px',
                        color: '#333',
                        textOutline: 'none'
                    }
                },
                borderRadius: 4,
                borderWidth: 0
            }
        },
        legend: { enabled: false },
        credits: { enabled: false },
        // 9. The data series for the chart.
        series: [{
            name: 'Anxiety Score',
            data: [] // To be filled with data later
        }]
    };
}

--- Dashboard_temp/app/static/js/components/hero-charts/anxiety-bar-chart/chart-events.js ---

function chartClickHandler() {
    // 1. `this` refers to the point that was clicked.
    const chart = this.series.chart;
    const state = chart.state;

    const clickedCategory = this.category;
    const clickedIndex = this.index;

    // 2. Check if the same bar is clicked again to deselect it.
    if (state.selectedFilter && state.selectedFilter.index === clickedIndex && state.selectedFilter.category === state.currentFilterCategory) {
        state.selectedFilter = null;
        resetAllData(); // 3. Reset all metrics to their original state.
        // 4. Reset bar colors to the original gradient.
        chart.series[0].points.forEach((point, idx) => {
            point.update({ color: chart.generatedColors[idx], borderWidth: 0 }, false);
        });
        chart.redraw();
    } else {
        // 5. A new bar is selected.
        state.selectedFilter = { category: state.currentFilterCategory, value: clickedCategory, index: clickedIndex };

        // 6. Highlight the selected bar.
        chart.series[0].points.forEach((point, idx) => {
            const isSelected = idx === clickedIndex;
            const config = {
                color: isSelected ? '#FFD700' : chart.generatedColors[idx],
                borderWidth: isSelected ? 2 : 0,
                borderColor: isSelected ? '#FFA500' : 'transparent'
            };
            point.update(config, false);
        });
        chart.redraw();

        // 7. Fetch filtered data from the server.
        const safeValue = normalizeFilterValue(state.currentFilterCategory, clickedCategory);
        fetch(`/api/filter_metrics/${state.currentFilterCategory}/${encodeURIComponent(safeValue)}`)
            .then(response => response.json())
            .then(data => {
                // Update all cards through a single, consistent function
                updateAllScoreCards(data.scores);

                // 9. Update the main anxiety score gauge.
                updateAnxietyGauge(data.average_anxiety_score);
            })
            .catch(error => console.error('Error fetching filtered metrics:', error));
    }
}

// --- NEW: normalize incoming label to backend-friendly value ---
function normalizeFilterValue(filterBy, value) {
    if (filterBy !== 'employment_status') return value;
    const v = String(value || '').trim();
    const aliases = {
        'Civil Servant/BUMN or Local Government': 'Civil Servant/BUMN',
        'Civil Servant / BUMN': 'Civil Servant/BUMN',
        'ASN/BUMN': 'Civil Servant/BUMN'
    };
    return aliases[v] || v;
}

// --- NEW: centralized updater + event hook used by both click and sort paths ---
function updateAllScoreCards(scores) {
    if (!scores) return;
    animateCounter('scoreLiterasiFin', scores['Literasi Finansial']);
    animateCounter('scoreLiterasiDigital', scores['Literasi Keuangan Digital']);
    animateCounter('scorePengelolaan', scores['Pengelolaan Keuangan']);
    animateCounter('scorePerilaku', scores['Sikap Finansial']);
    animateCounter('scoreDisiplin', scores['Disiplin Finansial']);
    // Ensure Financial Wellbeing is always updated, too
    animateCounter('scoreKesejahteraan', scores['Kesejahteraan Finansial']);
    animateCounter('scoreInvestasi', scores['Investasi Aset']);
}

// Expose the updater so the sorting routine can call it directly if it already has the scores
window.updateAllScoreCards = updateAllScoreCards;

// Optional: if your sort logic emits an event with the freshly computed scores,
// this listener will update every card (including Wellbeing) automatically.
document.addEventListener('filterMetricsUpdated', (e) => {
    // Expected payload: { detail: { scores, average_anxiety_score } }
    const { scores, average_anxiety_score } = e.detail || {};
    updateAllScoreCards(scores);
    if (typeof average_anxiety_score === 'number') {
        updateAnxietyGauge(average_anxiety_score);
    }
});

--- Dashboard_temp/app/static/js/components/wellbeing-animation.js ---

// Wellbeing card animations
function initWellbeingAnimations() {
    const house = document.querySelector("#house");
    const coins = document.querySelectorAll("#coins .coin");
    const windows = document.querySelectorAll("#left-window, #right-window");

    if (!house) {
        console.warn('Wellbeing house element not found, skipping animation');
        return;
    }

    // House floating animation
    gsap.to(house, {
        y: -2,
        duration: 2,
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut"
    });

    // Coins bouncing animation
    if (coins.length > 0) {
        gsap.to(coins, {
            y: -8,
            duration: 1.2,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            stagger: 0.2
        });
    }

    // Windows glowing animation
    if (windows.length > 0) {
        gsap.to(windows, {
            fill: getColor('--card3-illust-main'),
            duration: 1.6,
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            delay: 0.3
        });
    }
}


--- Dashboard_temp/app/static/js/components/hero-chart.js ---



--- Dashboard_temp/app/static/js/components/digital_time_chart.js ---

// static/js/components/digital_time_chart.js

/**
 * A helper function to read a CSS variable value from the root element.
 * @param {string} variable - The name of the CSS variable (e.g., '--chart-income').
 * @returns {string} The computed value of the variable.
 */
function getCssVariable(variable) {
    return getComputedStyle(document.documentElement).getPropertyValue(variable).trim();
}

function renderDigitalTimeChart(responseData, category) {
    const chartDiv = document.getElementById('digital-time-chart');
    if (!chartDiv) return;

    // Clear placeholder
    chartDiv.innerHTML = '';

    const { filtered_data, baseline_kde } = responseData;
    const { stats, histogram, kde } = filtered_data;

    if (stats.count === 0) {
        chartDiv.innerHTML = `<div class="placeholder-content"><i class="fas fa-info-circle fa-2x text-muted"></i><h6 class="mt-2">No Digital Engagement Data</h6></div>`;
        return;
    }

    // MODIFIED: Read main color from CSS variables
    const mainColor = getCssVariable('--chart-digital-main');

    // Helper to convert hex to rgba
    const hexToRgba = (hex, alpha) => {
        const r = parseInt(hex.slice(1, 3), 16);
        const g = parseInt(hex.slice(3, 5), 16);
        const b = parseInt(hex.slice(5, 7), 16);
        return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    };

    const histogramTrace = {
        x: histogram.x.slice(0, -1).map((edge, i) => (edge + histogram.x[i + 1]) / 2),
        y: histogram.y,
        type: 'bar', name: 'Frequency',
        marker: {
            color: hexToRgba(mainColor, 0.2),
            line: { color: hexToRgba(mainColor, 0.4), width: 1 }
        },
        hovertemplate: 'Time: %{x:.1f} hrs<br>Count: %{y}<extra></extra>',
    };

    const kdeTrace = {
        x: kde.x, y: kde.y, type: 'scatter', mode: 'lines', name: 'Smoothed Trend',
        line: { color: mainColor, width: 3 },
        fill: 'tozeroy', fillcolor: hexToRgba(mainColor, 0.1),
        hoverinfo: 'none'
    };

    const baselineKdeTrace = {
        x: baseline_kde.x, y: baseline_kde.y, type: 'scatter', mode: 'lines', name: 'Overall Trend',
        line: { color: getCssVariable('--chart-digital-baseline'), width: 2, dash: 'dash' },
        hoverinfo: 'none',
        visible: (category && category !== 'All') ? true : 'legendonly'
    };

    const titleCategory = category && category !== 'All' ? `for ${category}` : 'Overall';
    const chartTitle = `<b>ðŸ“± Digital Time Spent Distribution</b><br><span style="font-size:12px; color:#7f8c8d;">${stats.count} Respondents ${titleCategory}</span>`;

    const layout = {
        title: { text: chartTitle, x: 0.5, xanchor: 'center', font: { size: 16, family: 'Outfit, sans-serif' } },
        xaxis: { title: 'Digital Time Spent per Day (hours)' },
        yaxis: { title: 'Number of Respondents' },
        annotations: [{
            x: stats.mean, y: Math.max(...kde.y) * 0.95, text: `<b>Avg: ${stats.mean} hrs</b>`,
            showarrow: true, arrowhead: 2, ax: 0, ay: -40,
        }],
        barmode: 'overlay', showlegend: true,
        legend: { orientation: 'h', y: -0.2, x: 0.5, xanchor: 'center' },
        height: 180, margin: { l: 60, r: 30, t: 30, b: 50 },
        template: 'plotly_white',
        font: { family: 'Outfit, sans-serif' }
    };

    Plotly.newPlot(chartDiv, [histogramTrace, kdeTrace, baselineKdeTrace], layout, { displayModeBar: false, responsive: true });
}

function updateDigitalTimeChart(category) {
    const categoryParam = category || 'All';
    fetch(`/api/digital-time/${encodeURIComponent(categoryParam)}`)
        .then(response => response.json())
        .then(data => renderDigitalTimeChart(data, category));
}

function initializeDigitalTimeChart() {
    updateDigitalTimeChart(null);
}

--- Dashboard_temp/app/static/js/components/scales-animation.js ---

// Scales animation
function initScalesAnimation() {
    const scaleBeam = document.querySelector("#scale-beam");

    if (!scaleBeam) {
        console.warn('Scales elements not found, skipping animation');
        return;
    }

    const scalesTl = gsap.timeline({ repeat: -1, yoyo: true, defaults: { ease: "sine.inOut" } });
    scalesTl.to(scaleBeam, { rotation: -3, duration: 2, delay: 1 })
        .to(scaleBeam, { rotation: 3, duration: 2 })
        .to(scaleBeam, { rotation: 0, duration: 2 });
}


--- Dashboard_temp/app/static/js/new_charts_animations.js ---

// static/js/new_charts_animations.js

function initializeNewCharts() {
    console.log('Initializing new charts from Dashboard B...');

    // Initialize all the charts
    if (typeof initializeLoanCharts === 'function') {
        initializeLoanCharts();
    }
    if (typeof initializeDigitalTimeChart === 'function') {
        initializeDigitalTimeChart();
    }
    if (typeof initializeVisualAnalyticsCharts === 'function') {
        initializeVisualAnalyticsCharts();
    }

    // Set up a listener for the filter changes from the main diverging bar chart
    document.addEventListener('categoryFiltered', (e) => {
        console.log('Category filter changed event detected in new charts:', e.detail.category);
        
        if (typeof updateLoanPanel === 'function') {
            updateLoanPanel(e.detail.category);
        }
        if (typeof updateLoanPurposeChart === 'function') {
            updateLoanPurposeChart(e.detail.category);
        }
        if (typeof updateDigitalTimeChart === 'function') {
            updateDigitalTimeChart(e.detail.category);
        }
    });

    // We also need to handle the reset event
    document.addEventListener('categoryFilterReset', () => {
        console.log('Category filter reset event detected in new charts');
        
        if (typeof updateLoanPanel === 'function') {
            updateLoanPanel(null);
        }
        if (typeof updateLoanPurposeChart === 'function') {
            updateLoanPurposeChart(null);
        }
        if (typeof updateDigitalTimeChart === 'function') {
            updateDigitalTimeChart(null);
        }
    });
}

// This function will be responsible for the visual analytics charts
// It needs to be created. For now, it's a placeholder.
function initializeVisualAnalyticsCharts() {
    console.log('Initializing visual analytics charts (placeholder)...');
    // In a real scenario, you would fetch data and render the charts here.
}


--- Dashboard_temp/app/static/js/chart-styler.js ---

// static/js/chart-styler.js

/**
 * A helper function to read a CSS variable value from the root element.
 * @param {string} variable - The name of the CSS variable (e.g., '--chart-income').
 * @returns {string} The computed value of the variable.
 */
function getCssVariable(variable) {
    return getComputedStyle(document.documentElement).getPropertyValue(variable).trim();
}

/**
 * Applies styles from CSS variables to the Diverging Bar Chart.
 */
function styleDivergingBarChart() {
    const chartDiv = document.getElementById('diverging-bar-chart');
    if (!chartDiv || !chartDiv.data) return;

    const expenseColor = getCssVariable('--chart-expense');
    const expenseBorder = getCssVariable('--chart-expense-border');
    const incomeColor = getCssVariable('--chart-income');
    const incomeBorder = getCssVariable('--chart-income-border');

    // The order of traces is important. Trace 0 is 'Expense', Trace 1 is 'Income'.
    const update = {
        'marker.color': [expenseColor, incomeColor],
        'marker.line.color': [expenseBorder, incomeBorder],
        'marker.line.width': [1.5, 1.5]
    };

    Plotly.restyle(chartDiv, update);
}

/**
 * Applies styles from CSS variables to a stacked bar chart (Profession or Education).
 * @param {string} chartId - The ID of the chart div.
 */
function styleStackedBarChart(chartId) {
    const chartDiv = document.getElementById(chartId);
    if (!chartDiv || !chartDiv.data) return;

    const surplusColor = getCssVariable('--chart-surplus');
    const breakEvenColor = getCssVariable('--chart-break-even');
    const deficitColor = getCssVariable('--chart-deficit');

    const colorMap = {
        'Surplus': surplusColor,
        'Break-even': breakEvenColor,
        'Deficit': deficitColor
    };

    // Create an array of colors for each trace based on its name
    const traceColors = chartDiv.data.map(trace => colorMap[trace.name] || '#95a5a6');

    const update = {
        'marker.color': traceColors
    };

    Plotly.restyle(chartDiv, update);
}


/**
 * Main function to run all chart styling after the DOM is ready.
 * It uses a MutationObserver to wait for Plotly to render the charts.
 */
function initializeChartStyling() {
    const observer = new MutationObserver((mutationsList, observer) => {
        // Look for the creation of the Plotly chart elements
        const professionChartReady = document.querySelector('#profession-chart .main-svg');
        const educationChartReady = document.querySelector('#education-chart .main-svg');
        const divergingChartReady = document.querySelector('#diverging-bar-chart .main-svg');

        if (divergingChartReady) {
            styleDivergingBarChart();
        }
        if (professionChartReady) {
            styleStackedBarChart('profession-chart');
        }
        if (educationChartReady) {
            styleStackedBarChart('education-chart');
        }

        // If all charts are styled, we can disconnect the observer
        if (professionChartReady && educationChartReady && divergingChartReady) {
            observer.disconnect();
            console.log('Server-side charts dynamically styled.');
        }
    });

    const config = { childList: true, subtree: true };
    observer.observe(document.body, config);
}

// Wait for the DOM to be fully loaded before starting
document.addEventListener('DOMContentLoaded', initializeChartStyling);

--- Dashboard_temp/app/static/js/animations.js ---

// static/js/animations.js - UPDATED

// ... (keep the getColor helper function) ...
const rootStyles = getComputedStyle(document.documentElement);
const getColor = (variable) => rootStyles.getPropertyValue(variable).trim();

function initPageAnimations() {
    // ... (this function is fine as is) ...
    const dashboardWindow = document.querySelector(".dashboard-window");
    const mainCards = document.querySelectorAll(".main-card");

    if (!dashboardWindow) return;

    const tl = gsap.timeline({ defaults: { ease: "power3.out" } });

    tl.from(dashboardWindow, { scale: 0.9, opacity: 0, duration: 0.8 });

    // Animate hero and card-grid separately
    if (document.querySelector(".hero-section")) {
        tl.from(".hero-section", { y: 20, opacity: 0, duration: 0.6 }, "-=0.4");
    }
    if (mainCards.length > 0) {
        tl.from(mainCards, { scale: 0.95, opacity: 0, duration: 0.5, stagger: 0.2 }, "-=0.4");
    }
}

function initAllAnimations() {
    console.log('Initializing all animations...');

    initPageAnimations();
    initHeroCharts();
    initHeroTextAnimation();
    initDropdownAnimation();

    // NEW DYNAMIC COUNTER LOGIC
    // Find all elements with an ID starting with 'score' and a data-score attribute
    const scoreElements = document.querySelectorAll('[id^="score"][data-score]');
    scoreElements.forEach(el => {
        const targetValue = parseFloat(el.getAttribute('data-score'));
        // Check if the target is a valid number before animating
        if (!isNaN(targetValue)) {
            // We pass the element's ID and the dynamic target value
            animateCounter(el.id, targetValue);
        }
    });

    // The rest of the initializations are fine
    animateSmallCardValues(); // This function should also be checked if it uses hardcoded values
    initLightbulbAnimation();
    initScalesAnimation();
    initBgShapesAnimation();
    initWellbeingAnimations();
    initSparkleAnimations();
    initCoinAnimations();

    // Initialize charts from Dashboard B
    if (typeof initializeNewCharts === 'function') {
        initializeNewCharts();
    }
}

--- Dashboard_temp/app/static/js/background-shapes.js ---

// Generic background shapes animation (DRY)
function initBgShapesAnimation() {
    const animateShapes = (card, selector, config) => {
        card.addEventListener('mouseenter', () => {
            gsap.to(card.querySelectorAll(selector), {
                x: () => (Math.random() - 0.5) * (config.moveRange || 30),
                y: () => (Math.random() - 0.5) * (config.moveRange || 30),
                scale: () => 1 + (Math.random() - 0.5) * (config.scaleRange || 0.2),
                duration: config.duration || 1,
                ease: config.ease || 'elastic.out(1, 0.5)',
                stagger: config.stagger || 0.1
            });
        });
    };

    // Card 1 - Knowledge shapes
    const cardKnowledge = document.querySelector('.card-knowledge');
    if (cardKnowledge) {
        animateShapes(cardKnowledge, '.shape', { moveRange: 30, scaleRange: 0.2 });
    }

    // Card 2 - Decision particles
    const cardBehavior = document.querySelector('.card-behavior');
    if (cardBehavior) {
        animateShapes(cardBehavior, '.particle', { moveRange: 25, scaleRange: 0.4, duration: 1 });
        initParticleFloating();
    }

    // Card 3 - Wellbeing elements
    const cardWellbeing = document.querySelector('.card-wellbeing');
    if (cardWellbeing) {
        animateShapes(cardWellbeing, '.coin-shape', { moveRange: 15, scaleRange: 0.15, duration: 1.2 });
    }
}

// Particle floating animation for card 2
function initParticleFloating() {
    const particles = document.querySelectorAll('.card-behavior .particle');

    particles.forEach((particle, index) => {
        gsap.to(particle, {
            y: () => -15 - (Math.random() * 10),
            x: () => (Math.random() - 0.5) * 15,
            duration: 2 + (Math.random() * 1.5),
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            delay: index * 0.2
        });

        gsap.to(particle, {
            opacity: 0.4,
            scale: 1.2,
            duration: 1.8 + (Math.random() * 1),
            repeat: -1,
            yoyo: true,
            ease: "sine.inOut",
            delay: index * 0.15
        });
    });
}

// Sparkle twinkle animation for card 3
function initSparkleAnimations() {
    const sparkles = document.querySelectorAll('.card-wellbeing .sparkle');

    gsap.to(sparkles, {
        opacity: 1,
        scale: 1.3,
        duration: 1.5,
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut",
        stagger: {
            each: 0.3,
            repeat: -1
        }
    });

    // Rotate sparkles
    gsap.to(sparkles, {
        rotation: 45,
        duration: 3,
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut",
        stagger: 0.2
    });
}

// Coin floating animation for card 3
function initCoinAnimations() {
    const coins = document.querySelectorAll('.card-wellbeing .coin-shape');

    gsap.to(coins, {
        y: -10,
        duration: 2.5,
        repeat: -1,
        yoyo: true,
        ease: "sine.inOut",
        stagger: 0.3
    });
}


--- Dashboard_temp/app/static/js/scrollTrigger.js ---

// Minimal ScrollTrigger implementation
// For production, use the actual GSAP ScrollTrigger plugin
(function () {
    gsap.registerPlugin({
        name: "scrollTrigger",
        init: function (target, vars) {
            this.vars = vars;
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        if (this.animation) {
                            this.animation.play();
                        } else {
                            this.animation = gsap.getTweensOf(target)[0];
                        }
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: (vars.start && vars.start.includes('%')) ? `-${100 - parseInt(vars.start.split(' ')[1])}% 0px` : '0px'
            });

            if (target.nodeType) {
                observer.observe(target);
            } else if (target.length) {
                gsap.utils.toArray(target).forEach(el => observer.observe(el));
            }
            return true;
        }
    });
}());


--- Dashboard_temp/app/static/js/main.js ---

// static/js/main.js - NEW, SIMPLIFIED VERSION
document.addEventListener("DOMContentLoaded", () => {
    // The DOM is now fully built by the server.
    // We just need to initialize our animations.
    if (typeof initAllAnimations === 'function') {
        initAllAnimations();
    } else {
        console.error("initAllAnimations function not found!");
    }
});

--- Dashboard_temp/app/static/css/layout/layout.css ---

/* static/css/layout/layout.css */

/* Use a responsive two-column flex layout (do not force full viewport height) */
.dashboard-container {
    display: flex;
    align-items: flex-start;
    gap: var(--padding);
    width: 100%;
    box-sizing: border-box;
    padding: 0;
}

/* Make the left sidebar sticky so it stays visible while the right panel scrolls */
.left-panel {
    flex: 0 0 360px;
    max-width: 360px;
    min-width: 220px;
    display: flex;
    flex-direction: column;
    gap: var(--padding);
    box-sizing: border-box;
    align-self: flex-start;
    position: sticky;
    top: 16px;
    max-height: calc(100vh - 32px);
    overflow: auto;
    /* allow internal scroll if sidebar content is long */
    padding-right: 8px;
}

/* Allow the main area to take remaining space and have comfortable padding */
.right-panel {
    flex: 1 1 auto;
    min-width: 0;
    box-sizing: border-box;
    padding-left: 12px;
}

/* Prevent hero chart from forcing extra width/height */
.hero-chart-container--chart {
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
}

/* Styles for the sidebar header */
.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 16px;
}

.sidebar-header__title {
    flex: 1;
}

.sidebar-header__stat {
    flex-shrink: 0;
}

--- Dashboard_temp/app/static/css/layout/main-content.css ---

/* app/static/css/layout/main-content.css */
.main-content-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    width: 100%;
}

.full-width-row {
    grid-column: 1 / -1;
}

--- Dashboard_temp/app/static/css/components/small-cards.css ---

.small-card {
    background-color: var(--card4-bg);
    padding: 20px;
    border-radius: var(--border-radius);
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.small-card .label {
    font-size: 0.875rem;
    color: var(--card4-text-tertiary);
    font-weight: 500;
}

.small-card .value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--card4-text);
    line-height: 1;
}

--- Dashboard_temp/app/static/css/components/main-cards.css ---

.main-card {
    padding: 10px;
    border-radius: var(--border-radius);
    position: relative;
    overflow: hidden;
    min-height: 60px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.main-card h2 {
    font-size: 0.9rem;
    z-index: 9999;
    margin-top: 0px;
    margin-bottom: 10px;
    line-height: 1.3;
    font-weight: 600;
    max-width: 75%;
    color: var(--white);
}

.main-card p {
    display: none;
}

.main-card>* {
    position: relative;
}

--- Dashboard_temp/app/static/css/components/wellbeing-card.css ---

.card-wellbeing {
    background-color: var(--card4-bg);
}

/* Illustration sizing specific to Wellbeing card */
.main-card .illustration.house {
    bottom: 4px;
    width: 110px;
}

/* Background sparkles and coins specific to Wellbeing card */
.card-wellbeing .bg-shapes {
    height: 100%;
}

.card-wellbeing .sparkle {
    position: absolute;
    width: 8px;
    height: 8px;
    opacity: 0.6;
}

.card-wellbeing .sparkle::before,
.card-wellbeing .sparkle::after {
    content: '';
    position: absolute;
    background-color: var(--card3-sparkle);
}

.card-wellbeing .sparkle::before {
    width: 100%;
    height: 2px;
    top: 50%;
    left: 0;
    transform: translateY(-50%);
}

.card-wellbeing .sparkle::after {
    width: 2px;
    height: 100%;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
}

.card-wellbeing .sparkle1 {
    top: 20%;
    left: 15%;
}

.card-wellbeing .sparkle2 {
    top: 40%;
    left: 10%;
}

.card-wellbeing .sparkle3 {
    top: 60%;
    left: 20%;
}

.card-wellbeing .sparkle4 {
    top: 30%;
    left: 25%;
}

.card-wellbeing .sparkle5 {
    top: 50%;
    left: 5%;
}

.card-wellbeing .coin-shape {
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background-color: var(--card3-coin-bg);
    border: 3px solid var(--card3-coin-border);
    opacity: 0.7;
}

.card-wellbeing .coin-shape::after {
    content: '$';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--card3-coin-text);
    font-weight: 700;
    font-size: 20px;
}

.card-wellbeing .coin1 {
    bottom: 20%;
    left: 8%;
}

.card-wellbeing .coin2 {
    bottom: 35%;
    left: 18%;
    width: 35px;
    height: 35px;
}

.card-wellbeing .coin3 {
    bottom: 10%;
    left: 22%;
    width: 30px;
    height: 30px;
}

--- Dashboard_temp/app/static/css/components/illustrations.css ---

.main-card .illustration {
    position: absolute;
    right: 20px;
}

--- Dashboard_temp/app/static/css/components/visual_analytics.css ---

/* static/css/components/visual_analytics.css */

/* Top row container for side-by-side layout */
.top-row-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    width: 100%;
}

.visualization-grid {
    display: flex;
    flex-wrap: nowrap;
    width: 100%;
    background: #f8f9fa;
    border-radius: var(--border-radius);
    overflow: hidden;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
    font-size: 0.9rem;
}

.viz-panel {
    position: relative;
    background: white;
    border-right: 1px solid #dee2e6;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transition: opacity 0.3s ease, transform 0.2s ease;
}

.viz-panel:last-child {
    border-right: none;
}

.viz-main {
    flex: 0 0 50%;
    width: 60%;
    padding: 15px;
}

.viz-side {
    flex: 0 0 25%;
    width: 20%;
    padding: 10px 7px;
}

.viz-content {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
}

.viz-content>div {
    width: 100% !important;
    height: 100% !important;
    max-width: 100% !important;
}

.viz-footer {
    padding: 5px 7px;
    text-align: center;
    border-top: 1px solid #e9ecef;
    background: rgba(248, 249, 250, 0.7);
    flex-shrink: 0;
    font-size: 0.6rem;
    font-weight: 500;
}

.viz-footer strong {
    color: #e67e22;
}

--- Dashboard_temp/app/static/css/components/behavior-card.css ---

.card-behavior {
    background-color: var(--card2-bg);
}

/* Illustration sizing specific to Behavior card */
.main-card .illustration.scales {
    bottom: 20px;
    right: 8px;
    width: 75px;
}

/* Footer and heading color overrides for Behavior card */
.card-behavior .card-content h2 {
    color: var(--card2-text);
    font-weight: 700;
}

.card-behavior .card-footer-label {
    color: var(--card2-text);
    font-weight: 500;
}

.card-behavior .card-footer-label i {
    color: var(--card2-text);
}

.card-behavior .card-footer-value {
    color: var(--card2-text);
}

/* Background particles specific to Behavior card */
.card-behavior .bg-shapes {
    height: 100%;
}

.card-behavior .particle {
    position: absolute;
    border-radius: 50%;
    background-color: var(--card2-particle);
    opacity: var(--card2-particle-opacity);
}

.card-behavior .particle1 {
    width: 8px;
    height: 8px;
    bottom: 25%;
    left: 12%;
}

.card-behavior .particle2 {
    width: 12px;
    height: 12px;
    bottom: 55%;
    left: 20%;
}

.card-behavior .particle3 {
    width: 6px;
    height: 6px;
    bottom: 70%;
    left: 15%;
}

.card-behavior .particle4 {
    width: 10px;
    height: 10px;
    bottom: 40%;
    left: 8%;
}

.card-behavior .particle5 {
    width: 14px;
    height: 14px;
    bottom: 15%;
    left: 18%;
}

.card-behavior .particle6 {
    width: 7px;
    height: 7px;
    bottom: 60%;
    left: 10%;
}

.card-behavior .particle7 {
    width: 9px;
    height: 9px;
    bottom: 35%;
    left: 22%;
}

--- Dashboard_temp/app/static/css/components/map_controls.css ---

/* static/css/components/map_controls.css */

.map-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
    padding: 0.5rem;
    background-color: var(--ui-subtle-bg);
    border-radius: var(--border-radius);
}

.map-controls .custom-dropdown {
    position: relative;
    display: inline-block;
    cursor: pointer;
}

.map-controls .dropdown-selected {
    background-color: var(--white);
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    font-weight: 600;
    color: var(--text-primary);
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem; /* Smaller font size */
}

.map-controls .dropdown-selected:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
}

.map-controls .dropdown-options {
    position: absolute;
    top: calc(100% + 8px);
    left: 0;
    list-style: none;
    padding: 0.5rem;
    margin: 0;
    background-color: var(--white);
    border-radius: var(--border-radius);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    overflow: hidden;
    z-index: 10;
    opacity: 0;
    transform: translateY(10px);
    pointer-events: none;
    transition: all 0.3s ease;
    min-width: 100%;
    white-space: nowrap;
}

.map-controls .custom-dropdown.open .dropdown-options {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

.map-controls .dropdown-options li {
    padding: 0.75rem 1.25rem;
    transition: background-color 0.2s ease;
    border-radius: 6px;
    font-size: 0.75rem; /* Smaller font size */
}

.map-controls .dropdown-options li:hover {
    background-color: var(--ui-subtle-bg);
}

.map-control-button {
    background-color: var(--card2-bg);
    color: var(--white);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 0.525rem; /* 40% smaller than 0.875rem */
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.map-control-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.1);
}


--- Dashboard_temp/app/static/css/components/background-shapes.css ---

.bg-shapes {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 50%;
    z-index: -1;
}

.bg-shapes .shape {
    position: absolute;
    border-radius: 50%;
    opacity: 0.5;
}

--- Dashboard_temp/app/static/css/components/knowledge-card.css ---

.card-knowledge {
    background-color: var(--card1-bg);
}

/* Illustration sizing specific to Knowledge card */
.main-card .illustration.light {
    top: 25px;
    width: 55px;
    height: 55px;
}

/* Background shapes specific to Knowledge card */
.card-knowledge .shape1 {
    background-color: var(--card1-illust-bg-shape1);
    width: 200px;
    height: 200px;
    bottom: -100px;
    left: 120px;
}

.card-knowledge .shape2 {
    background-color: var(--card1-illust-bg-shape2);
    width: 150px;
    height: 150px;
    bottom: -75px;
    left: 50px;
}

.card-knowledge .shape3 {
    background-color: var(--card1-illust-bg-shape3);
    width: 180px;
    height: 180px;
    bottom: -90px;
    right: -20px;
}

--- Dashboard_temp/app/static/css/components/card-footer.css ---

.card-footer {
    margin-top: auto;
    display: flex;
    gap: 12px;
    flex-wrap: nowrap;
    position: relative;
    z-index: 2;
}

.card-footer-item {
    flex: 1;
    min-width: 0;
    display: flex;
    flex-direction: column-reverse;
}

.card-footer-label {
    font-size: 7px;
    color: var(--card1-text-secondary);
    margin-top: 4px;
    margin-bottom: 0;
    line-height: 1.2;
    white-space: normal;
    display: flex;
    align-items: center;
    gap: 4px;
}

.card-footer-label i {
    font-size: 10px;
    opacity: 0.8;
}

.card-footer-label span {
    flex: 1;
}

.card-footer-value {
    font-size: 1.3rem;
    /* Reduced from 2rem */
    font-weight: 700;
    line-height: 1;
    color: var(--card1-text);
}

--- Dashboard_temp/app/static/css/components/hero/hero-section.css ---



--- Dashboard_temp/app/static/css/components/charts_panel.css ---

/* static/css/components/charts_panel.css */

.charts-section-panel {
    background-color: #ffffff;
    padding: 1rem;
    border-radius: var(--border-radius);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
    border: 1px solid var(--border-color);
}

.charts-section-panel h4 {
    font-weight: 400;
    color: var(--text-primary);
    text-align: center;
    margin-bottom: 10px !important;
    margin-top: 0px;
    font-size: 1.1rem;
}

.loan-kpi-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
    gap: 0.4rem;
    margin-bottom: 0.6rem;
}

.loan-kpi-card {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 5px;
    padding: 0.5rem;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    position: relative;
    color: white;
}

.loan-kpi-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

.loan-kpi-card.primary {
    background: linear-gradient(135deg, #5DADE2 0%, #3498db 100%);
}

.loan-kpi-card.success {
    background: linear-gradient(135deg, #1ba991 0%, #16a085 100%);
}

.loan-kpi-card.warning {
    background: linear-gradient(135deg, #ff8b53 0%, #e67e22 100%);
}

.loan-kpi-card.danger {
    background: linear-gradient(135deg, #f24f09 0%, #c0392b 100%);
}

.loan-kpi-label {
    font-size: 0.3rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    opacity: 0.9;
    margin-bottom: 3px;
    font-weight: 600;
}

.loan-kpi-value {
    font-size: 0.72rem;
    font-weight: 700;
    margin-bottom: 2px;
    line-height: 1.2;
}

.loan-kpi-subtext {
    font-size: 0.28rem;
    opacity: 0.85;
    margin-top: 2px;
}

#loan-overview-chart,
#loan-purpose-chart,
#digital-time-chart {
    transition: opacity 0.3s ease;
}

.chart-container {
    background-color: white;
    border-radius: 8px;
    padding: 5px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.chart-container .js-plotly-plot,
.chart-container .plotly,
.chart-container .plotly-graph-div {
    width: 100% !important;
    height: 100% !important;
}

.placeholder-content {
    display: none;
}

/* Side-by-side layout for Loan Overview and Loan Purpose charts */
.loan-charts-grid {
    display: grid;
    grid-template-columns: 4fr 6fr;
    gap: 12px;
}

/* Slightly tighter containers for these two charts */
.loan-charts-grid .chart-container {
    padding: 5px;
}

--- Dashboard_temp/app/static/css/components/hero-section.css ---

/* static/css/components/hero-section.css */

/* The .hero-text-content rule is now removed */

.hero-title {
    font-size: 2rem;
    font-weight: 800;
    margin: 0;
    line-height: 1.1;
    letter-spacing: -0.03em;
    color: #181829;
    background: #1ba991;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* MODIFIED: Re-aligning the description container */
.hero-description-container {
    display: flex;
    flex-wrap: wrap;
    /* Allow wrapping on smaller screens */
    align-items: baseline;
    justify-content: flex-start;
    /* Align content to the left */
    text-align: left;
    /* Ensure text inside is left-aligned */
    gap: 0.5em;
    font-size: 0.6rem;
    color: var(--text-secondary);
    width: 100%;
    line-height: 1.6;
    margin-bottom: 8px;
    /* slight spacing above chart */
    padding: 0;
    /* remove side padding to align edges */
}

.hero-description {
    margin: 0;
}

/* General styles for the white containers */
.hero-chart-container {
    background-color: var(--white);
    border-radius: var(--border-radius);
    padding: 15px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.05);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
    width: 90%;
    min-height: 95px;
}

/* NEW: Make the chart container align with description (left) and take full width */
.hero-chart-container--chart {
    align-items: flex-start;
    /* stop centering children */
    text-align: left;
    /* left-align inner text */
    width: 100%;
    /* match parent width */
}

/* MODIFIED: Make the anxiety component's wrapper transparent and compact */
#anxiety-container {
    background-color: transparent;
    box-shadow: none;
    padding: 0;
    /* Remove padding */
}

/* MODIFIED: Reset min-height for the stat container */
.hero-chart-container--stat {
    position: relative;
    cursor: pointer;
    min-height: auto;
    /* Let the content define the height */
}

/* Custom Dropdown (Styles restored and enhanced) */
.custom-dropdown {
    position: relative;
    display: inline-block;
    cursor: pointer;
}

/* MODIFIED: Restoring and enhancing the dropdown's visual style */
.dropdown-selected {
    font-weight: 700;
    color: var(--card2-bg);
    /* Use a distinct color */
    border-bottom: 2px solid var(--card2-bg);
    /* Add the underline */
    padding: 0 4px 2px 4px;
    /* Add some padding for a better click area */
    transition: background-color 0.2s ease, transform 0.2s ease;
}

.dropdown-selected:hover {
    background-color: rgba(93, 173, 226, 0.1);
    /* Subtle hover effect */
    transform: translateY(-1px);
    /* Slight lift on hover */
}

.dropdown-options {
    position: absolute;
    top: 100%;
    left: 0;
    list-style: none;
    padding: 0;
    margin: 10px 0 0;
    background-color: var(--white);
    border-radius: var(--border-radius);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    z-index: 10;
    opacity: 0;
    transform: translateY(10px);
    pointer-events: none;
}

.custom-dropdown.open .dropdown-options {
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
}

.dropdown-options li {
    padding: 12px 20px;
    transition: background-color 0.2s ease;
}

.dropdown-options li:hover {
    background-color: var(--ui-subtle-bg);
}

.anxiety-face-wrapper {
    position: relative;
    width: 70px;
    /* Reduced from 80px */
    height: 70px;
    /* Reduced from 80px */
    display: flex;
    align-items: center;
    justify-content: center;
}

/* MODIFIED: Further reducing the emoji character's size */
.anxiety-emoji {
    font-size: 40px;
    /* Reduced from 48px */
    line-height: 1;
    transform-origin: center center;
}

/* MODIFIED: Further reducing the gap */
.anxiety-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 2px;
    /* Reduced from 4px */
    flex-grow: 1;
    width: 100%;
    height: 100%;
}

/* MODIFIED: Tucking the gauge in closer */
.anxiety-gauge {
    position: absolute;
    right: 10px;
    /* Adjusted from 15px */
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    align-items: center;
    gap: 5px;
    /* Reduced from 6px */
}

/* MODIFIED: Making the gauge track smaller again */
.anxiety-gauge__track {
    position: relative;
    width: 12px;
    /* Reduced from 14px */
    height: 80px;
    /* Reduced from 90px */
    border-radius: 999px;
    background: var(--ui-subtle-bg);
    box-shadow: inset 0 0 0 1px var(--border-color);
    overflow: hidden;
}

.anxiety-gauge__fill {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 0%;
    background: linear-gradient(to bottom, rgb(255, 136, 81), rgba(255, 251, 142));
}

/* MODIFIED: Adjusting the scale to the new, smaller height */
.anxiety-gauge__scale {
    display: flex;
    flex-direction: column-reverse;
    justify-content: space-between;
    height: 70px;
    /* Reduced from 80px */
    font-size: 0.55rem;
    /* Reduced from 0.6rem */
    color: var(--text-tertiary);
}

.anxiety-gauge__scale span {
    line-height: 1;
}

/* MODIFIED: Further reducing the score's font size */
.anxiety-gauge__value {
    font-size: 1.5rem;
    /* Reduced from 1.75rem */
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1;
}

/* MODIFIED: Making the label text even smaller */
.stat-label {
    font-size: 0.65rem;
    /* Reduced from 0.7rem */
    color: var(--text-tertiary);
    font-weight: 500;
    margin: 0;
    margin-top: 4px;
}

/* MODIFIED: Ensure the chart div is flexible to fill remaining space */
.hero-chart {
    width: 100%;
    height: 100%;
    align-self: stretch;
    /* stretch to container width */
}

--- Dashboard_temp/app/static/css/base/base.css ---

@import url('https://fonts.googleapis.com/css2?family=Anta&family=Doto:wght@100..900&family=Outfit:wght@100..900&family=Pixelify+Sans:wght@400..700&family=Press+Start+2P&family=Stack+Sans+Notch:wght@200..700&display=swap');

body {
    margin: 0;
    background-color: var(--bg-color);
    font-family: 'Outfit', sans-serif;
    color: var(--text-primary);
}


/* Make sure page never produces horizontal scroll due to viewport-width quirk,
   but allow normal vertical scrolling when content grows. */
html,
body {
    overflow-x: hidden;
}



h1,
h2,
h3,
h4,
h5,
h6 {
    font-family: 'Stack Sans Notch', sans-serif;
}

/* Make sure page never produces horizontal scroll due to viewport-width quirk,
   but allow normal vertical scrolling when content grows. */
html,
body {
    overflow-x: hidden;
}

/* Use full available width (not 100vw) to avoid extra horizontal scroll from scrollbars,
   remove strict centering so layout can use full width with small padding. */
.dashboard-window {
    width: 100%;
    max-width: none;
    margin: 0;
    padding: 12px 16px;
    box-sizing: border-box;
    overflow-x: hidden;
    /* prevent horizontal overflow */
    overflow-y: visible;
    /* allow vertical flow / page scroll */
}

/* Two-column container used in index.html */
.dashboard-container {
    display: flex;
    gap: 20px;
    align-items: flex-start;
    width: 100%;
    box-sizing: border-box;
}

/* Left sidebar: fixed sensible width */
.left-panel {
    flex: 0 0 360px;
    max-width: 360px;
    min-width: 220px;
    box-sizing: border-box;
}

/* Right panel: flexible and allowed to grow; do NOT force internal scroll here
   so the whole page will scroll when content is tall (prevents inner overlay scrollbar). */
.right-panel {
    flex: 1 1 auto;
    min-width: 0;
    /* critical for flex children to wrap instead of overflow */
    box-sizing: border-box;
    overflow: visible;
    /* let page scroll rather than internal scrollbar overlapping chart */
}

/* Important: allow visualization blocks to expand vertically (avoid clipping)
   but still prevent them forcing horizontal overflow. */
.viz-content,
.visualization-grid,
.viz-panel {
    min-width: 0;
    overflow-x: visible;
    /* allow chart title to render fully */
    overflow-y: visible;
    box-sizing: border-box;
}

/* Ensure Plotly/chart containers don't inject fixed large inline widths */
.chart-container>div,
.viz-content>div {
    width: 100% !important;
    max-width: 100%;
    box-sizing: border-box;
}

/* Make sure Plotly containers behave responsively and don't force horizontal overflow */
.chart-container,
.viz-content {
    width: 100%;
    box-sizing: border-box;
    overflow: visible;
    /* allow markers/labels to show */
}

/* Limit any generated Plotly divs/svg to the parent's width */
.plotly-graph-div,
.plotly .main-svg {
    max-width: 100% !important;
    width: 100% !important;
    height: auto !important;
    box-sizing: border-box;
}

/* Ensure long chart titles / legend labels wrap instead of overflow */
.plotly .gtitle text,
.plotly .legend text,
.plotly-graph-div .modebar-container {
    white-space: normal !important;
}

/* Slightly reduce outer padding to reclaim edge space */
.dashboard-window {
    padding-left: 12px;
    padding-right: 12px;
}

--- Dashboard_temp/app/static/css/base/colors.css ---

:root {
    /* General Palette */
    --bg-color: #ddf2ed;
    --text-primary: #3A4150;
    --text-secondary: #5E6573;
    --text-tertiary: #8C93A0;
    --text-monospace: #888888;
    --border-color: #E1E4E8;
    --ui-subtle-bg: #F7F8FA;
    --white: #FFFFFF;

    /* Card Backgrounds - BOLD & SATURATED */
    --card1-bg: #1ba991;
    /* Bold Pink */
    --card2-bg: #5DADE2;
    /* Bold Orange */
    --card3-bg: #ff8114;
    /* Bold Blue */
    --card4-bg: #ff8b53;
    /* Bold Purple */

    /* Card 1 (Knowledge) - Pink Theme */
    --card1-illust-main: #FFE5EE;
    --card1-illust-bg-shape1: rgba(255, 255, 255, 0.2);
    --card1-illust-bg-shape2: rgba(255, 255, 255, 0.15);
    --card1-illust-bg-shape3: rgba(255, 255, 255, 0.25);
    --card1-text: #FFFFFF;
    --card1-text-secondary: rgba(255, 255, 255, 0.85);

    /* Card 2 (Behavior) - Orange Theme with Dark Text */
    --card2-illust-main: #FFF4E6;
    --card2-illust-accent: #FFF4E6;
    --card2-text: #FFF4E6;
    --card2-text-secondary: #FFF4E6;
    --card2-particle: #7aebfa;
    --card2-particle-opacity: 0.3;



    /* --card2-illust-accent: #602e0f;
    --card2-text: #602e0f;
    --card2-text-secondary: #602e0f;
    --card2-particle: #ec803c;
    --card2-particle-opacity: 1;
 */
    /* Card 3 (Wellbeing) - Purple Theme */
    --card3-illust-main: #fffbe9;
    --card3-illust-accent: #f5eac9;
    --card3-illust-dark: #f7b23c;
    --card3-illust-roof: #f4ad28;
    --card3-text: #FFFFFF;
    --card3-text-secondary: rgba(255, 255, 255, 0.85);
    --card3-sparkle: rgba(255, 255, 255, 0.8);
    --card3-coin-bg: rgba(253, 138, 44, 0.4);
    --card3-coin-border: rgba(254, 176, 73, 0.4);
    --card3-coin-text: rgb(254, 171, 16);

    /* Card 4 (Small Cards) */
    --card4-text: #FFFFFF;
    --card4-text-secondary: rgba(255, 255, 255, 0.9);
    --card4-text-tertiary: rgba(255, 255, 255, 0.7);

    /* Shared Illustration Colors */
    --illust-base: #D3D3D3;
    --illust-stroke: #2C3E50;
    --illust-ground: #95A5A6;
    --illust-window-body: #FFFFFF;

    /* Button Colors */
    --button-hover: #e9e1d9;

    /* 
    ==============================================
    NEW: Centralized Chart Color Palette 
    ==============================================
    */
    /* Diverging Bar Chart (Income vs Expense) */
    --chart-income: #1ba991;
    --chart-income-border: #119d85;
    --chart-expense: #e74c3c;
    --chart-expense-border: #d83c2b;

    /* Stacked Bar Charts (Financial Standing) */
    --chart-surplus: #1ba991;
    --chart-break-even: #ff8b53;
    --chart-deficit: #e74c3c;

    /* Loan Pie Chart */
    --chart-loan-no-loan: #1ba991;
    --chart-loan-tier-1: #5DADE2;
    /* <5M */
    --chart-loan-tier-2: #ff8b53;
    /* 5M-10M */
    --chart-loan-tier-3: #f24f09;
    /* 10M-15M */
    --chart-loan-tier-4: #e74c3c;
    /* >15M */

    /* Digital Time Chart */
    --chart-digital-main: #1ba991;
    /* Used for line and bars */
    --chart-digital-baseline: rgba(128, 128, 128, 0.5);
}

--- Dashboard_temp/app/static/css/base/variables.css ---

:root {
    /* Layout & Spacing */
    --border-radius: 20px;
    --padding: 24px;
}

--- Dashboard_temp/app/static/css/main.css ---

@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@200..800&display=swap');
/* Import all modular stylesheets */
@import url('base/colors.css');
@import url('base/variables.css');
@import url('base/base.css');
@import url('layout/layout.css');
@import url('components/main-cards.css');
@import url('components/illustrations.css');
@import url('components/card-footer.css');
@import url('components/background-shapes.css');
@import url('components/small-cards.css');
@import url('components/hero-section.css');
@import url('components/knowledge-card.css');
@import url('components/behavior-card.css');
@import url('components/wellbeing-card.css');
@import url('components/visual_analytics.css');
@import url('components/charts_panel.css');

--- Dashboard_temp/app/__init__.py ---

from flask import Flask

app = Flask(__name__)

from app import routes


--- Dashboard_temp/app/utils/charts/diverging_chart.py ---

import plotly.graph_objects as go


def create_diverging_bar_chart(chart_data):
    categories = chart_data["categories"]
    income_pct = chart_data["income_percentages"]
    expense_pct = chart_data["expense_percentages"]
    income_counts = chart_data["income_counts"]
    expense_counts = chart_data["expense_counts"]

    fig = go.Figure()

    fig.add_trace(
        go.Bar(
            name="Expense",
            y=categories,
            x=[-pct for pct in expense_pct],
            orientation="h",
            marker=dict(
                color="#e74c3c", line=dict(color="#c0392b", width=0.5), opacity=0.9
            ),
            text=[f"{pct:.1f}%" for pct in expense_pct],
            textposition="inside",
            textfont=dict(size=5, color="white", family="Arial, sans-serif"),
            hovertemplate="<b>%{y}</b><br>Expense: %{text}<br>Count: %{customdata}<br><extra></extra>",
            customdata=expense_counts,
            meta=[f"expense_{cat}" for cat in categories],
        )
    )

    fig.add_trace(
        go.Bar(
            name="Income",
            y=categories,
            x=income_pct,
            orientation="h",
            marker=dict(
                color="#3498db", line=dict(color="#2980b9", width=0.5), opacity=0.9
            ),
            text=[f"{pct:.1f}%" for pct in income_pct],
            textposition="inside",
            textfont=dict(size=5, color="white", family="Arial, sans-serif"),
            hovertemplate="<b>%{y}</b><br>Income: %{text}<br>Count: %{customdata}<br><extra></extra>",
            customdata=income_counts,
            meta=[f"income_{cat}" for cat in categories],
        )
    )

    fig.update_layout(
        title={
            "text": '<b>âš–ï¸ Income vs Expense Distribution</b><br><sub style="font-size:5px; color:#7f8c8d; font-weight:normal;">Click any bar to highlight category â€¢ Click again to deselect</sub>',
            "x": 0.5,
            "xanchor": "center",
            "font": {"size": 6, "family": "Arial, sans-serif", "color": "#2c3e50"},
        },
        barmode="overlay",
        xaxis={
            "title": "<b>Percentage of Population</b>",
            "tickvals": [-40, -30, -20, -10, 0, 10, 20, 30, 40],
            "ticktext": ["40%", "30%", "20%", "10%", "0%", "10%", "20%", "30%", "40%"],
            "title_font": {"size": 4, "color": "#34495e"},
            "tickfont": {"size": 4, "color": "#34495e"},
            "gridcolor": "rgba(189, 195, 199, 0.3)",
            "zeroline": True,
            "zerolinewidth": 2,
            "zerolinecolor": "#95a5a6",
        },
        yaxis={
            "title": "<b>Financial Category (IDR/month)</b>",
            "title_font": {"size": 4, "color": "#34495e"},
            "tickfont": {"size": 4, "color": "#34495e"},
            "gridcolor": "rgba(189, 195, 199, 0.2)",
            "side": "left",
        },
        template="plotly_white",
        height=192,
        width=174,
        showlegend=True,
        legend=dict(
            orientation="h",
            yanchor="top",
            y=-0.18,
            xanchor="center",
            x=0.5,
            font={"size": 4, "color": "#2c3e50"},
            bgcolor="rgba(255, 255, 255, 0.9)",
            bordercolor="#bdc3c7",
            borderwidth=1,
        ),
        plot_bgcolor="rgba(250, 250, 250, 1)",
        paper_bgcolor="white",
        margin=dict(l=34, r=14, t=30, b=2),
        hoverlabel=dict(bgcolor="white", font_size=5, font_family="Arial, sans-serif"),
    )

    chart_html = fig.to_html(
        include_plotlyjs=False,
        div_id="diverging-bar-chart",
        config={
            "displayModeBar": True,
            "displaylogo": False,
            "responsive": True,
            "modeBarButtonsToRemove": ["pan2d", "lasso2d", "select2d"],
            "toImageButtonOptions": {
                "format": "png",
                "filename": "income_vs_expense_chart",
                "height": 288,
                "width": 576,
                "scale": 2,
            },
        },
    )

    interactive_script = """
    <script>
    (function() {
        function initializeChartInteractivity() {
            const chartDiv = document.getElementById('diverging-bar-chart');
            if (!chartDiv || typeof Plotly === 'undefined' || !chartDiv.data) {
                setTimeout(initializeChartInteractivity, 100);
                return;
            }
            
            let selectedCategory = null;
            const originalTickFont = { size: 5, color: '#34495e', family: 'Arial, sans-serif' };
            
            chartDiv.on('plotly_click', function(data) {
                const point = data.points[0];
                const category = point.y;
                
                if (selectedCategory === category) {
                    resetFilter();
                } else {
                    applyFilter(category);
                }
            });
            
            function applyFilter(category) {
                selectedCategory = category;
                chartDiv.setAttribute('data-selected-category', category);
                setTimeout(() => {
                    const event = new CustomEvent('categoryFiltered', { detail: { category: category }, bubbles: true });
                    document.dispatchEvent(event);
                }, 10);
                
                const categoryIndex = chartDiv.data[0].y.indexOf(category);
                const barUpdate = { 'marker.opacity': [], 'marker.line.width': [] };
                
                chartDiv.data.forEach((trace) => {
                    const opacities = [];
                    const lineWidths = [];
                    trace.y.forEach((cat) => {
                        if (cat === category) { opacities.push(1.0); lineWidths.push(3); } else { opacities.push(0.25); lineWidths.push(1); }
                    });
                    barUpdate['marker.opacity'].push(opacities);
                    barUpdate['marker.line.width'].push(lineWidths);
                });
                
                Plotly.restyle(chartDiv, barUpdate);
                
                const tickColors = chartDiv.data[0].y.map(cat => cat === category ? '#e67e22' : 'rgba(52, 73, 94, 0.4)');
                const tickSizes = chartDiv.data[0].y.map(cat => cat === category ? 6 : 5);
                const labelUpdate = { 'yaxis.tickfont.color': tickColors, 'yaxis.tickfont.size': tickSizes };
                Plotly.relayout(chartDiv, labelUpdate);
                
                setTimeout(() => {
                    const yaxisLabels = chartDiv.querySelectorAll('.ytick text');
                    yaxisLabels.forEach((label, idx) => {
                        if (idx === categoryIndex) { label.style.fontWeight = 'bold'; label.style.fill = '#e67e22'; label.style.fontSize = '6px'; label.style.transition = 'all 0.3s ease'; }
                        else { label.style.fontWeight = 'normal'; label.style.fill = 'rgba(52, 73, 94, 0.4)'; label.style.fontSize = '5px'; }
                    });
                }, 50);
            }
            
            function resetFilter() {
                selectedCategory = null;
                chartDiv.removeAttribute('data-selected-category');
                setTimeout(() => {
                    const event = new CustomEvent('categoryFilterReset', { bubbles: true });
                    document.dispatchEvent(event);
                }, 10);
                
                const numCategories = chartDiv.data[0].y.length;
                const fullOpacity = Array(numCategories).fill(0.9);
                const standardWidth = Array(numCategories).fill(1.5);
                const barUpdate = { 'marker.opacity': [fullOpacity, fullOpacity], 'marker.line.width': [standardWidth, standardWidth] };
                Plotly.restyle(chartDiv, barUpdate);
                
                const originalTickFont = { size: 5, color: '#34495e', family: 'Arial, sans-serif' };
                const labelUpdate = { 'yaxis.tickfont': originalTickFont };
                Plotly.relayout(chartDiv, labelUpdate);
                
                setTimeout(() => {
                    const yaxisLabels = chartDiv.querySelectorAll('.ytick text');
                    yaxisLabels.forEach(label => { label.style.fontWeight = 'normal'; label.style.fill = '#34495e'; label.style.fontSize = '5px'; });
                }, 50);
            }
            
            window.chartResetFilter = resetFilter;
            document.addEventListener('categoryFilterReset', function() { if (selectedCategory !== null) resetFilter(); });
        }
        
        if (document.readyState === 'loading') { document.addEventListener('DOMContentLoaded', initializeChartInteractivity); } else { initializeChartInteractivity(); }
    })();
    </script>
    """

    return chart_html + interactive_script


--- Dashboard_temp/app/utils/charts/profession_chart.py ---

import plotly.graph_objects as go


def create_profession_chart(profession_data):
    fig = go.Figure()
    categories = profession_data["categories"]
    colors = profession_data["colors"]

    for standing in ["Surplus", "Break-even", "Deficit"]:
        if standing in profession_data["data"]:
            values = profession_data["data"][standing]
            hover_text = []
            for i, cat in enumerate(categories):
                count = profession_data["total_counts"].get(cat, 0)
                pct = values[i]
                actual_count = int((pct / 100) * count)
                hover_text.append(
                    f"{cat}<br>{standing}: {pct:.1f}% ({actual_count} people)"
                )

            fig.add_trace(
                go.Bar(
                    name=standing,
                    x=categories,
                    y=values,
                    marker=dict(
                        color=colors.get(standing, "#95a5a6"),
                        line=dict(color="rgba(255,255,255,0.5)", width=1),
                    ),
                    hovertext=hover_text,
                    hoverinfo="text",
                    text=[f"{v:.0f}%" if v > 8 else "" for v in values],
                    textposition="inside",
                    textfont=dict(size=4, color="white"),
                )
            )

    fig.update_layout(
        title={
            "text": "<b>Employment vs<br>Financial Standing</b>",  # force line break to avoid clipping
            "x": 0.5,
            "xanchor": "center",
            "y": 0.98,
            "yanchor": "top",
            "pad": {"t": 5},  # increased padding top
            "font": {"size": 7, "color": "#2c3e50"},
        },
        xaxis={
            "tickfont": {"size": 4, "color": "#34495e"},
            "showgrid": False,
            "tickangle": -45,
        },
        yaxis={
            "tickfont": {"size": 4, "color": "#34495e"},
            "gridcolor": "rgba(189, 195, 199, 0.2)",
            "range": [0, 100],
        },
        barmode="stack",
        template="plotly_white",
        height=187,
        width=72,
        showlegend=True,
        legend={
            "orientation": "h",
            "x": 0.5,
            "xanchor": "center",
            "y": -0.3,
            "yanchor": "top",
            "font": {"size": 8},
            "bgcolor": "rgba(0,0,0,0)",
        },
        margin=dict(l=0, r=14, t=24, b=5),
        hoverlabel=dict(bgcolor="white", font_size=5),
    )

    return fig.to_html(
        include_plotlyjs=False,
        div_id="profession-chart",
        config={"displayModeBar": False, "responsive": True},
    )


--- Dashboard_temp/app/utils/charts/grouped_chart.py ---

import plotly.graph_objects as go


def create_grouped_bar_chart(chart_data):
    categories = chart_data["categories"]
    income_pct = chart_data["income_percentages"]
    expense_pct = chart_data["expense_percentages"]
    income_counts = chart_data["income_counts"]
    expense_counts = chart_data["expense_counts"]

    fig = go.Figure()
    fig.add_trace(
        go.Bar(
            name="Income Distribution",
            x=categories,
            y=income_pct,
            text=[f"{pct:.1f}%" for pct in income_pct],
            textposition="outside",
            marker_color="#3498db",
            hovertemplate="<b>Income: %{x}</b><br>Percentage: %{y:.1f}%<br>Count: %{customdata}<extra></extra>",
            customdata=income_counts,
        )
    )
    fig.add_trace(
        go.Bar(
            name="Expense Distribution",
            x=categories,
            y=expense_pct,
            text=[f"{pct:.1f}%" for pct in expense_pct],
            textposition="outside",
            marker_color="#e74c3c",
            hovertemplate="<b>Expense: %{x}</b><br>Percentage: %{y:.1f}%<br>Count: %{customdata}<extra></extra>",
            customdata=expense_counts,
        )
    )

    fig.update_layout(
        title={
            "text": "ðŸ’° GenZ Income vs Expense Distribution by Category",
            "x": 0.5,
            "xanchor": "center",
            "font": {"size": 11},
        },
        xaxis={"title": "Category (IDR per month)"},
        yaxis={"title": "Percentage of Population (%)"},
        barmode="group",
        template="plotly_white",
        height=288,
        legend=dict(orientation="h", y=1.05, x=0.5, xanchor="center"),
    )

    return fig.to_html(
        include_plotlyjs=False,
        div_id="grouped-bar-chart",
        config={"displayModeBar": True, "displaylogo": False},
    )


--- Dashboard_temp/app/utils/charts/education_chart.py ---

import plotly.graph_objects as go


def create_education_chart(education_data):
    fig = go.Figure()
    categories = education_data["categories"]
    colors = education_data["colors"]

    abbreviated_cats = []
    for cat in categories:
        if len(cat) > 15:
            if "Bachelor" in cat:
                abbreviated_cats.append("Bachelor/D4")
            elif "Diploma I" in cat:
                abbreviated_cats.append("Diploma I-III")
            elif "Senior High" in cat:
                abbreviated_cats.append("High School")
            elif "Junior High" in cat:
                abbreviated_cats.append("Junior High")
            elif "Elementary" in cat:
                abbreviated_cats.append("Elementary")
            elif "Postgraduate" in cat:
                abbreviated_cats.append("Postgrad")
            else:
                abbreviated_cats.append(cat[:15])
        else:
            abbreviated_cats.append(cat)

    for standing in ["Surplus", "Break-even", "Deficit"]:
        if standing in education_data["data"]:
            values = education_data["data"][standing]
            hover_text = []
            for i, cat in enumerate(categories):
                count = education_data["total_counts"].get(cat, 0)
                pct = values[i]
                actual_count = int((pct / 100) * count)
                hover_text.append(
                    f"{cat}<br>{standing}: {pct:.1f}% ({actual_count} people)"
                )

            fig.add_trace(
                go.Bar(
                    name=standing,
                    x=abbreviated_cats,
                    y=values,
                    marker=dict(
                        color=colors.get(standing, "#95a5a6"),
                        line=dict(color="rgba(255,255,255,0.5)", width=1),
                    ),
                    hovertext=hover_text,
                    hoverinfo="text",
                    text=[f"{v:.0f}%" if v > 8 else "" for v in values],
                    textposition="inside",
                    textfont=dict(size=4, color="white"),
                )
            )

    fig.update_layout(
        title={
            "text": "<b>ðŸŽ“ Education vs<br>Financial Standing (%)</b>",
            "x": 0.5,
            "xanchor": "center",
            "y": 0.98,
            "yanchor": "top",
            "pad": {"t": 4},  # tighten title spacing
            "font": {"size": 7, "color": "#2c3e50"},
        },
        xaxis={
            "tickfont": {"size": 4, "color": "#34495e"},
            "showgrid": False,
            "tickangle": -45,
        },
        yaxis={
            "tickfont": {"size": 4, "color": "#34495e"},
            "gridcolor": "rgba(189, 195, 199, 0.2)",
            "range": [0, 100],
        },
        barmode="stack",
        template="plotly_white",
        height=187,
        width=72, 
        showlegend=True,
        legend={
            "orientation": "h",
            "x": 0.5,
            "xanchor": "center",
            "y": -0.3,
            "yanchor": "top",
            "font": {"size": 8},
            "bgcolor": "rgba(0,0,0,0)",
        },
        margin=dict(l=0, r=14, t=24, b=5),
        hoverlabel=dict(bgcolor="white", font_size=5),
    )

    return fig.to_html(
        include_plotlyjs=False,
        div_id="education-chart",
        config={"displayModeBar": False, "responsive": True},
    )


--- Dashboard_temp/app/utils/chart_generator.py ---

"""
Chart Generator Module
Creates visualizations using Plotly
"""

from app.utils.charts.diverging_chart import (
    create_diverging_bar_chart as _create_diverging,
)
from app.utils.charts.profession_chart import (
    create_profession_chart as _create_profession,
)
from app.utils.charts.education_chart import create_education_chart as _create_education
from app.utils.charts.grouped_chart import create_grouped_bar_chart as _create_grouped


class ChartGenerator:
    """Thin wrapper delegating to chart-specific modules"""

    @staticmethod
    def create_diverging_bar_chart(chart_data):
        return _create_diverging(chart_data)
    
    @staticmethod
    def create_profession_chart(profession_data):
        return _create_profession(profession_data)
    
    @staticmethod
    def create_education_chart(education_data):
        return _create_education(education_data)
    
    @staticmethod
    def create_grouped_bar_chart(chart_data):
        return _create_grouped(chart_data)


--- Dashboard_temp/app/utils/__init__.py ---



--- Dashboard_temp/app/utils/engagement_processor.py ---

"""
Digital Engagement Processor Module
Handles analysis of 'digital_time_spent_per_day' data.
"""
import pandas as pd
import numpy as np
from scipy.stats import gaussian_kde

class EngagementProcessor:
    """Processes and analyzes digital engagement data."""

    def __init__(self, df):
        """
        Initialize EngagementProcessor with a DataFrame.

        Args:
            df (pd.DataFrame): DataFrame containing 'digital_time_spent_per_day'.
        """
        self.df = df

    def get_engagement_distribution(self):
        """
        Calculates histogram and KDE for 'digital_time_spent_per_day'.

        Returns:
            dict: A dictionary containing histogram data, KDE data, and summary statistics.
                  Returns an empty structure if no valid data is available.
        """
        # 1. Clean and validate the data
        time_data = self.df['digital_time_spent_per_day'].dropna()
        if time_data.empty or len(time_data) < 2:
            return self._get_empty_distribution()

        # 2. Calculate summary statistics
        stats = {
            'count': int(time_data.count()),
            'mean': round(float(time_data.mean()), 2),
            'median': round(float(time_data.median()), 2),
            'std_dev': round(float(time_data.std()), 2),
            'min': round(float(time_data.min()), 2),
            'max': round(float(time_data.max()), 2)
        }

        # 3. Calculate histogram data
        # Use numpy's histogram function for robust binning
        counts, bin_edges = np.histogram(time_data, bins='auto', density=False)
        
        histogram_data = {
            'x': bin_edges.tolist(),
            'y': counts.tolist()
        }

        # 4. Calculate KDE data
        try:
            kde = gaussian_kde(time_data)
            # Generate points for the KDE curve
            kde_x = np.linspace(time_data.min(), time_data.max(), 200)
            kde_y = kde(kde_x)
            
            # Scale KDE to match histogram counts instead of density
            # Area under histogram = sum(counts * bin_width)
            bin_width = bin_edges[1] - bin_edges[0]
            kde_y_scaled = kde_y * stats['count'] * bin_width

            kde_data = {
                'x': kde_x.tolist(),
                'y': kde_y_scaled.tolist()
            }
        except (np.linalg.LinAlgError, ValueError):
            # Handle cases where KDE calculation fails (e.g., all values are the same)
            kde_data = {'x': [], 'y': []}

        return {
            'stats': stats,
            'histogram': histogram_data,
            'kde': kde_data
        }

    def _get_empty_distribution(self):
        """Returns a default empty structure for when there's no data."""
        return {
            'stats': {
                'count': 0, 'mean': 0, 'median': 0, 'std_dev': 0, 'min': 0, 'max': 0
            },
            'histogram': {'x': [], 'y': []},
            'kde': {'x': [], 'y': []}
        }

--- Dashboard_temp/app/utils/loan_processor.py ---

"""
Loan Processor Module
Handles outstanding loan data analysis and categorization
"""

import pandas as pd
import numpy as np


class LoanProcessor:
    """Processes and analyzes outstanding loan data"""

    # Loan category definitions (in IDR)
    LOAN_CATEGORIES = [
        {"name": "No Loan", "min": 0, "max": 0, "color": "#27ae60"},
        {"name": "<5M", "min": 0.01, "max": 5_000_000, "color": "#3498db"},
        {"name": "5M-10M", "min": 5_000_001, "max": 10_000_000, "color": "#f39c12"},
        {"name": "10M-15M", "min": 10_000_001, "max": 15_000_000, "color": "#e67e22"},
        {"name": ">15M", "min": 15_000_001, "max": float("inf"), "color": "#e74c3c"},
    ]

    # Loan purpose visual mapping - ADDED 'Undefined'
    LOAN_PURPOSE_MAP = {
        'Konsumsi': {'color': '#ff8b53', 'icon': 'ðŸ›’'},
        'Pendidikan': {'color': '#1ba991', 'icon': 'ðŸŽ“'},
        'Usaha': {'color': '#5DADE2', 'icon': 'ðŸ’¼'},
        'Gaya': {'color': '#f24f09', 'icon': 'ðŸ’„'},
        'Lainnya': {'color': '#95a5a6', 'icon': 'ðŸ“Š'},
        'Undefined': {'color': '#bdc3c7', 'icon': 'â“'}
    }

    def __init__(self, df):
        """
        Initialize LoanProcessor with DataFrame

        Args:
            df (pd.DataFrame): DataFrame containing outstanding_loan column
        """
        self.df = df
        self.loan_categories = self.LOAN_CATEGORIES

    def get_loan_statistics(self):
        """
        Calculate comprehensive loan statistics

        Returns:
            dict: Loan statistics including mean, median, distribution
        """
        loan_data = self.df["outstanding_loan"].replace(0, np.nan).dropna()

        if len(loan_data) == 0:
            return self._get_empty_stats()

        stats = {
            "total_respondents": len(self.df),
            "with_loan": int((self.df["outstanding_loan"] > 0).sum()),
            "without_loan": int((self.df["outstanding_loan"] == 0).sum()),
            "mean": float(loan_data.mean()),
            "median": float(loan_data.median()),
            "max": float(loan_data.max()),
            "min": float(loan_data.min()),
            "std": float(loan_data.std()),
            "total_outstanding": float(loan_data.sum()),
        }

        # Calculate percentages
        stats["with_loan_pct"] = (
            round((stats["with_loan"] / stats["total_respondents"]) * 100, 1)
            if stats["total_respondents"] > 0
            else 0
        )
        stats["without_loan_pct"] = (
            round((stats["without_loan"] / stats["total_respondents"]) * 100, 1)
            if stats["total_respondents"] > 0
            else 0
        )

        return stats

    def get_loan_distribution(self):
        """
        Categorize loans into ranges for visualization

        Returns:
            dict: Distribution data with categories, counts, and percentages
        """
        distribution = []
        total = len(self.df)

        for category in self.loan_categories:
            count = self._count_loans_in_category(category)
            percentage = round((count / total) * 100, 1) if total > 0 else 0.0

            distribution.append(
                {
                    "category": category["name"],
                    "count": count,
                    "percentage": percentage,
                    "color": category["color"],
                }
            )

        return {
            "categories": [d["category"] for d in distribution],
            "counts": [d["count"] for d in distribution],
            "percentages": [d["percentage"] for d in distribution],
            "colors": [d["color"] for d in distribution],
        }

    def validate_loan_data(self):
        """
        Validate outstanding_loan data for accuracy and integrity

        Returns:
            dict: Validation report with statistics and issues
        """
        report = {
            "total_records": len(self.df),
            "valid_records": 0,
            "invalid_records": 0,
            "issues": [],
            "data_types": {},
            "value_ranges": {},
            "statistics": {},
        }

        loan_column = self.df["outstanding_loan"]
        report["data_types"]["current_dtype"] = str(loan_column.dtype)

        # Convert to numeric if needed
        try:
            loan_numeric = pd.to_numeric(loan_column, errors="coerce")
            report["data_types"]["conversion_success"] = True
        except Exception as e:
            report["data_types"]["conversion_success"] = False
            report["issues"].append(f"Conversion error: {str(e)}")
            return report

        # Check for invalid values
        null_count = int(loan_numeric.isnull().sum())
        negative_count = int((loan_numeric < 0).sum())
        excessive_count = int((loan_numeric > 100_000_000).sum())

        report["valid_records"] = len(loan_numeric) - null_count - negative_count
        report["invalid_records"] = null_count + negative_count

        if null_count > 0:
            report["issues"].append(f"Found {null_count} null/invalid values")
        if negative_count > 0:
            report["issues"].append(f"Found {negative_count} negative values")
        if excessive_count > 0:
            report["issues"].append(
                f"Found {excessive_count} values > 100M IDR (potential outliers)"
            )

        # Value ranges
        valid_loans = loan_numeric[loan_numeric >= 0].dropna()
        if len(valid_loans) > 0:
            report["value_ranges"] = {
                "min": float(valid_loans.min()),
                "max": float(valid_loans.max()),
                "mean": float(valid_loans.mean()),
                "median": float(valid_loans.median()),
                "std": float(valid_loans.std()),
            }

        # Category distribution
        report["statistics"]["by_category"] = {}
        for category in self.loan_categories:
            count = self._count_loans_in_category(category, loan_numeric)
            report["statistics"]["by_category"][category["name"]] = count

        return report

    def get_filtered_loan_data_by_income(self, income_category):
        """
        Get comprehensive loan data filtered by income category

        Args:
            income_category (str): Income category to filter by (e.g., '<2jt', '2-4jt')

        Returns:
            dict: Filtered loan statistics with distribution
        """
        # Filter dataframe
        if income_category and income_category != "All":
            filtered_df = self.df[self.df["avg_income_category"] == income_category]
        else:
            filtered_df = self.df

        if len(filtered_df) == 0:
            return self._get_empty_filtered_stats(income_category)

        # CRITICAL FIX: Fill NaN with 0 before processing
        # Ensures NULL values are treated as "No Loan" for consistent counting
        loan_data = filtered_df["outstanding_loan"].fillna(0)
        loan_data_with_loans = loan_data[loan_data > 0]

        # Calculate statistics
        stats = {
            "filter_applied": income_category if income_category else "All",
            "total_respondents": len(filtered_df),
            "with_loan": int((loan_data > 0).sum()),
            "without_loan": int((loan_data == 0).sum()),
            "with_loan_pct": 0.0,
            "without_loan_pct": 0.0,
            "mean": 0.0,
            "median": 0.0,
            "mode": 0.0,
            "max": 0.0,
            "min": 0.0,
            "total_outstanding": 0.0,
        }

        if len(loan_data_with_loans) > 0:
            stats["mean"] = float(loan_data_with_loans.mean())
            stats["median"] = float(loan_data_with_loans.median())
            stats["max"] = float(loan_data_with_loans.max())
            stats["min"] = float(loan_data_with_loans.min())
            stats["total_outstanding"] = float(loan_data_with_loans.sum())

            # Calculate mode
            mode_result = loan_data_with_loans.mode()
            stats["mode"] = float(mode_result.iloc[0]) if len(mode_result) > 0 else 0.0

        stats["with_loan_pct"] = (
            round((stats["with_loan"] / stats["total_respondents"]) * 100, 1)
            if stats["total_respondents"] > 0
            else 0
        )
        stats["without_loan_pct"] = (
            round((stats["without_loan"] / stats["total_respondents"]) * 100, 1)
            if stats["total_respondents"] > 0
            else 0
        )

        # Calculate distribution for filtered data
        distribution = []
        for category in self.loan_categories:
            count = self._count_loans_in_category(category, loan_data)
            percentage = (
                round((count / len(filtered_df)) * 100, 1)
                if len(filtered_df) > 0
                else 0.0
            )

            distribution.append(
                {
                    "category": category["name"],
                    "count": count,
                    "percentage": percentage,
                    "color": category["color"],
                }
            )

        stats["distribution"] = distribution

        return stats

    def get_loan_purpose_distribution(self):
        """
        Calculates the distribution of loan usage purposes, including undefined ones.
        This ensures the total number of borrowers matches the loan distribution chart.

        Returns:
            list: A list of dictionaries with loan purpose distribution data,
                  sorted by count with 'Undefined' placed last.
        """
        # 1. Get all records with an outstanding loan > 0
        borrowers_df = self.df[self.df["outstanding_loan"] > 0].copy()

        if borrowers_df.empty:
            return []

        # 2. Normalize 'loan_usage_purpose' to group all non-defined purposes
        borrowers_df["loan_usage_purpose"] = borrowers_df["loan_usage_purpose"].fillna(
            "Undefined"
        )
        borrowers_df["loan_usage_purpose"] = borrowers_df["loan_usage_purpose"].replace(
            ["Tidak Ada", ""], "Undefined"
        )

        # 3. Calculate value counts
        purpose_counts = borrowers_df["loan_usage_purpose"].value_counts()
        total_borrowers = len(borrowers_df)

        # 4. Build the distribution list with all required attributes
        distribution = []
        for purpose, count in purpose_counts.items():
            percentage = (count / total_borrowers) * 100 if total_borrowers > 0 else 0
            mapping = self.LOAN_PURPOSE_MAP.get(
                purpose, self.LOAN_PURPOSE_MAP["Lainnya"]
            )

            distribution.append(
                {
                    "purpose": purpose,
                    "count": int(count),
                    "percentage": round(percentage, 1),
                    "color": mapping["color"],
                    "icon": mapping["icon"],
                }
            )

        # 5. Sort by count descending, but ensure 'Undefined' is always last
        distribution.sort(key=lambda x: (x["purpose"] == "Undefined", -x["count"]))

        return distribution

    def _count_loans_in_category(self, category, loan_data=None):
        """
        Count loans in a specific category (NULL-safe)

        Args:
            category (dict): Category definition with min/max values
            loan_data (pd.Series, optional): Loan data to count. Defaults to self.df['outstanding_loan']

        Returns:
            int: Count of loans in category
        """
        if loan_data is None:
            loan_data = self.df["outstanding_loan"]

        # CRITICAL FIX: Fill NaN with 0 to ensure all records are categorized
        # Treats missing loan data as "No Loan" for consistent aggregation
        loan_data = loan_data.fillna(0)

        if category["max"] == 0:
            return int((loan_data == 0).sum())
        elif category["max"] == float("inf"):
            return int((loan_data >= category["min"]).sum())
        else:
            return int(
                ((loan_data >= category["min"]) & (loan_data <= category["max"])).sum()
            )

    def _get_empty_stats(self):
        """Return empty statistics structure"""
        return {
            "total_respondents": len(self.df),
            "with_loan": 0,
            "without_loan": len(self.df),
            "mean": 0.0,
            "median": 0.0,
            "max": 0.0,
            "min": 0.0,
            "std": 0.0,
            "total_outstanding": 0.0,
            "with_loan_pct": 0.0,
            "without_loan_pct": 100.0,
        }

    def _get_empty_filtered_stats(self, category):
        """Return empty filtered statistics structure"""
        return {
            "filter_applied": category,
            "total_respondents": 0,
            "with_loan": 0,
            "without_loan": 0,
            "with_loan_pct": 0.0,
            "without_loan_pct": 0.0,
            "mean": 0.0,
            "median": 0.0,
            "mode": 0.0,
            "max": 0.0,
            "min": 0.0,
            "total_outstanding": 0.0,
            "distribution": [],
        }

    @staticmethod
    def format_currency(amount):
        """
        Format amount as Indonesian Rupiah

        Args:
            amount (float): Amount to format

        Returns:
            str: Formatted currency string
        """
        if amount >= 1_000_000_000:
            return f"Rp {amount/1_000_000_000:.1f}B"
        elif amount >= 1_000_000:
            return f"Rp {amount/1_000_000:.1f}M"
        elif amount >= 1_000:
            return f"Rp {amount/1_000:.1f}K"
        else:
            return f"Rp {amount:.0f}"


--- Dashboard_temp/app/routes.py ---

from flask import render_template, jsonify
from app import app
from app.services import (
    get_main_metrics, get_anxiety_by_category, get_filtered_metrics,
    get_visual_analytics_data, get_filtered_loan_data, get_loan_purpose_data,
    get_digital_time_data, get_regional_data_from_file, get_financial_data_from_file
)

@app.route('/')
def index():
    main_metrics = get_main_metrics()
    scores = main_metrics['scores']
    viz_data = get_visual_analytics_data()

    page_data = {
        "hero_section": {
            "title": "Gen Z Financial Dashboard",
            "anxiety_score": main_metrics['average_anxiety_score']
        },
        "knowledge_card": {
            "title": "Financial Knowledge",
            "score_literasi_finansial": scores.get('Literasi Finansial', 0),
            "score_literasi_digital": scores.get('Literasi Keuangan Digital', 0)
        },
        "behavior_card": {
            "title": "Financial Behavior",
            "score_pengelolaan": scores.get('Pengelolaan Keuangan', 0),
            "score_perilaku": scores.get('Sikap Finansial', 0),
            "score_disiplin": scores.get('Disiplin Finansial', 0)
        },
        "wellbeing_card": {
            "title": "Financial Wellbeing",
            "score_kesejahteraan": scores.get('Kesejahteraan Finansial', 0),
            "score_investasi": scores.get('Investasi Aset', 0)
        }
    }
    return render_template('index.html', data=page_data, chart_html=viz_data['chart_html'], profession_chart=viz_data['profession_chart'], education_chart=viz_data['education_chart'])

@app.route('/data/anxiety_by/<filter_by>')
def anxiety_by_filter(filter_by):
    data = get_anxiety_by_category(filter_by)
    return jsonify(categories=data['categories'], scores=data['scores'])

@app.route('/api/filter_metrics/<filter_by>/<path:filter_value>')
def filtered_metrics(filter_by, filter_value):
    try:
        metrics = get_filtered_metrics(filter_by, filter_value)
        return jsonify(scores=metrics['scores'], average_anxiety_score=metrics['average_anxiety_score'])
    except Exception as e:
        return jsonify(error=str(e)), 500

@app.route('/api/loan-filtered/<category>')
def api_loan_filtered(category):
    data = get_filtered_loan_data(category)
    return jsonify(data)

@app.route('/api/loan-purpose/<category>')
def api_loan_purpose(category):
    data = get_loan_purpose_data(category)
    return jsonify(data)

@app.route('/api/digital-time/<category>')
def api_digital_time(category):
    data = get_digital_time_data(category)
    return jsonify(data)

@app.route("/api/data")
def get_regional_data():
    """Endpoint untuk data indikator ekonomi regional."""
    data = get_regional_data_from_file()
    if "error" in data:
        return jsonify(data), 404
    return jsonify(data)


@app.route("/api/financial-profile")
def get_financial_data():
    """Endpoint untuk data profil finansial Gen Z yang sudah diagregasi."""
    data = get_financial_data_from_file()
    if "error" in data:
        return jsonify(data), 404
    return jsonify(data)



--- Dashboard_temp/app/services.py ---

import pandas as pd
import numpy as np
from app.utils.loan_processor import LoanProcessor
from app.utils.engagement_processor import EngagementProcessor
from app.utils.chart_generator import ChartGenerator
import os
from datetime import datetime  # Import the datetime module


def _calculate_scores(df):
    metrics = {
        "Literasi Finansial": [
            "I am able to identify risks and discrepancies and view numbers in a complex way",
            "I am able to understand what is behind the numbers",
            "I am able to understand numbers and financial metrics",
            "I am able to understand what drives cash flow and profits",
            "I am able to understand the company's financial statements and some core performance measures",
            "I pay attention to news about the economy as it may affect my family",
        ],
        "Literasi Keuangan Digital": [
            "Awareness about the potential of financial risk in using digital financial provider or fintech, such as the legality of the fintech provider, interest rate and transaction fee",
            "Having experience in using the product and service of fintech for digital payment",
            "Having a good understanding of digital payment products such as E-Debit, E-Credit, E-Money, Mobile/Internet banking, E -wallet",
            "Having a good understanding of digital alternatives",
            "Having a good understanding of digital insurance",
            "Having a good understanding of customer rights and protection as well as the procedure to complain about the service from digital  financial providers",
        ],
        "Investasi Aset": [
            "I am able to recognize a good financial investment",
            "Experience in using the product and service of fintech for financing (loan) and investment",
            "Experience in using the product and service of fintech for asset management",
            "Having a good understanding of product digital asset management",
        ],
        "Pengelolaan Keuangan": [
            "I am able to and divide it accordingly across an allotted period to the right concerned areas",
            "I am able to project the amount of cash that will be available to me in the future",
            "I take part in domestic expense planning",
            "I suggest at home that we keep money aside for emergencies",
            "I am able to search for economic options during financial decision making",
            "I am able to foresee the long term and short-term consequences of the financial decisions I undertake",
        ],
        "Disiplin Finansial": [
            "I am able to plan ahead to avoid impulse spending",
            "I always try to save some money to do things I really like",
            "I always like to negotiate prices when I buy",
            "I keep an eye on promotions and discounts",
            "I like to think thoroughly before deciding to buy something",
            "I like to research prices whenever I buy something",
        ],
        "Sikap Finansial": [
            "I usually have a critical view of the way my friends deal with money",
            "I like to participate in family decision making when we buy something expensive for home",
            "I advise others on money matters",
            "I often do things without giving them much thought",
            "I am impulsive",
            "I say things before I have thought them through",
            "I am able to quickly change my financial decisions as per the changes in circumstance",
            "Appraise of personal risk helps me in better financial decision making",
            "I make sound financial decision by comparing results over the time",
            "I make sound financial decisions by comparing results over expenses involved",
            "Previously used decision strategies help me in better financial decision making",
        ],
        "Kesejahteraan Finansial": [
            "I am becoming financially secure",
            "I am securing my financial future",
            "I will achieve the financial goals that I have set for myself",
            "I have saved (or will be able to save) enough money to last me to the end of my life",
            "Because of my money situation, I feel I will never have the things I want in life",
            "I am behind with my finances",
            "My finances control my life",
            "Whenever I feel in control of my finances, something happens that sets me back",
            "I am unable to enjoy life because I obsess too much about money",
        ],
    }

    negative_polarity_questions = [
        "I often do things without giving them much thought",
        "I am impulsive",
        "I say things before I have thought them through",
        "Because of my money situation, I feel I will never have the things I want in life",
        "I am behind with my finances",
        "My finances control my life",
        "Whenever I feel in control of my finances, something happens that sets me back",
        "I am unable to enjoy life because I obsess too much about money",
    ]

    df_copy = df.copy()
    for question in negative_polarity_questions:
        if question in df_copy.columns:
            df_copy[question] = 5 - df_copy[question]

    scores = {}
    for metric, questions in metrics.items():
        existing_questions = [q for q in questions if q in df_copy.columns]
        if existing_questions:
            metric_scores = df_copy[existing_questions].mean(axis=1)
            avg_score = metric_scores.mean()
            if pd.isna(avg_score):
                scores[metric] = 0
            else:
                scores[metric] = round(((avg_score - 1) / 3) * 100)
        else:
            scores[metric] = 0
    return scores


def get_main_metrics():
    df = pd.read_csv(
        os.path.join(os.path.dirname(__file__), "..", "dataset", "Sheet2.csv")
    )
    scores = _calculate_scores(df)
    df_anxiety = pd.read_csv(
        os.path.join(os.path.dirname(__file__), "..", "dataset", "Sheet1.csv")
    )
    average_anxiety_score = df_anxiety["financial_anxiety_score"].mean()
    return {"scores": scores, "average_anxiety_score": average_anxiety_score}


def get_anxiety_by_category(filter_by="employment_status"):
    df = pd.read_csv(
        os.path.join(os.path.dirname(__file__), "..", "dataset", "Sheet1.csv")
    )

    # Normalize employment_status values to handle variations
    if filter_by == "employment_status":
        df["employment_status"] = df["employment_status"].replace(
            {
                "Entrepreneur": "Entrepreneur",
                "entrepreneur": "Entrepreneur",
                "Enterpreneur": "Entrepreneur",  # Handle common typo
                "enterpreneur": "Entrepreneur",
                "Not Working": "Not Working",
                "Student": "Student",
                "Private Employee": "Private Employee",
                "Civil Servant/BUMN": "Civil Servant/BUMN",
            }
        )

    # MODIFIED: Logic to handle age calculation
    category_column = filter_by
    if filter_by == "birth_year":
        current_year = 2025  # As per the context of our session
        df["age"] = current_year - df["birth_year"]
        category_column = "age"

    anxiety_by_category = (
        df.groupby(category_column)["financial_anxiety_score"]
        .mean()
        .round(1)
        .reset_index()
    )
    anxiety_by_category = anxiety_by_category.sort_values(
        "financial_anxiety_score", ascending=False
    )

    return {
        "categories": anxiety_by_category[category_column].tolist(),
        "scores": anxiety_by_category["financial_anxiety_score"].tolist(),
    }


def get_filtered_metrics(filter_by, filter_value):
    df1 = pd.read_csv(
        os.path.join(os.path.dirname(__file__), "..", "dataset", "Sheet1.csv")
    )
    df2 = pd.read_csv(
        os.path.join(os.path.dirname(__file__), "..", "dataset", "Sheet2.csv")
    )

    # Normalize employment_status values in both datasets
    if filter_by == "employment_status":
        df1["employment_status"] = df1["employment_status"].replace(
            {
                "Entrepreneur": "Entrepreneur",
                "entrepreneur": "Entrepreneur",
                "Enterpreneur": "Entrepreneur",
                "enterpreneur": "Entrepreneur",
                "Not Working": "Not Working",
                "Student": "Student",
                "Private Employee": "Private Employee",
                "Civil Servant/BUMN": "Civil Servant/BUMN",
            }
        )
        # Normalize filter_value as well
        filter_value = str(filter_value).replace("Enterpreneur", "Entrepreneur")

    # MODIFIED: This block now handles converting age back to birth year for filtering
    sheet1_filter_value = filter_value
    if filter_by == "birth_year":
        try:
            # The filter_value is an age, e.g., "25"
            age = int(filter_value)
            current_year = 2025  # As per context
            # Convert age back to birth year to filter the original data
            sheet1_filter_value = current_year - age
        except ValueError:
            return {"scores": {}, "average_anxiety_score": 0}

    # Normalize Sheet2 Job values to collapse variants into a single canonical form
    if "Job" in df2.columns:
        df2["Job"] = df2["Job"].astype(str).str.strip()
        # Normalize Civil Servant/BUMN variations (with or without extra descriptors)
        df2["Job"] = df2["Job"].replace(
            {r"^Civil\s*Servant\s*/\s*BUMN(?:.*)?$": "Civil Servant/BUMN"}, regex=True
        )
        # Normalize common variations for other jobs as well
        df2["Job"] = df2["Job"].replace(
            {
                "entrepreneur": "Entrepreneur",
                "Enterpreneur": "Entrepreneur",
                "enterpreneur": "Entrepreneur",
            }
        )

    column_mapping = {
        "employment_status": "Job",
        "education_level": "Last Education",
        "gender": "Gender",
        "birth_year": "Year of Birth",  # This mapping remains correct
    }

    value_mapping = {
        "Elementary School": "Elementary School (SD)",
        "Junior High School": "Junior High School (SMP)",
        "Senior High School": "Senior High School (SMA)",
        "Entrepreneur": "Entrepreneur",  # Add explicit mapping
        "Not Working": "Not Working",
        "Student": "Student",
        "Private Employee": "Private Employee",
        # After normalization, Sheet2 uses 'Civil Servant/BUMN'
        "Civil Servant/BUMN": "Civil Servant/BUMN",
    }

    sheet2_column = column_mapping.get(filter_by, filter_by)
    # The filter value for sheet2 also needs to be the calculated birth year
    sheet2_filter_value = value_mapping.get(
        str(sheet1_filter_value), sheet1_filter_value
    )

    filtered_df1 = df1[df1[filter_by] == sheet1_filter_value]
    average_anxiety_score = filtered_df1["financial_anxiety_score"].mean()

    df_filtered = df2[df2[sheet2_column] == sheet2_filter_value]
    scores = _calculate_scores(df_filtered)

    return {"scores": scores, "average_anxiety_score": average_anxiety_score}


# --- New functions from Dashboard B ---

NEW_DATASET_PATH = os.path.join(
    os.path.dirname(__file__),
    "..",
    "dataset",
    "dataset_gelarrasa_genzfinancialprofile.csv",
)


class DataLoader:
    def __init__(self, csv_path):
        self.csv_path = csv_path
        self.df = None
        self.category_order = [
            "N/A",
            "<2jt",
            "2-4jt",
            "4-6jt",
            "6-10jt",
            "10-15jt",
            ">15jt",
        ]

    def load_data(self):
        if not os.path.exists(self.csv_path):
            raise FileNotFoundError(f"CSV file not found: {self.csv_path}")
        self.df = pd.read_csv(self.csv_path)

        # Normalize employment_status column to handle variations
        if "employment_status" in self.df.columns:
            self.df["employment_status"] = self.df["employment_status"].replace(
                {
                    "Entrepreneur": "Entrepreneur",
                    "entrepreneur": "Entrepreneur",
                    "Enterpreneur": "Entrepreneur",
                    "enterpreneur": "Entrepreneur",
                    "Not Working": "Not Working",
                    "Student": "Student",
                    "Private Employee": "Private Employee",
                    "Civil Servant/BUMN": "Civil Servant/BUMN",
                }
            )

        return self.df

    def get_chart_data(self):
        if self.df is None:
            self.load_data()
        income_counts = self.df["avg_income_category"].value_counts()
        expense_counts = self.df["avg_expense_category"].value_counts()
        income_pct = (income_counts / income_counts.sum() * 100).round(2)
        expense_pct = (expense_counts / expense_counts.sum() * 100).round(2)
        viz_data = pd.DataFrame(
            {
                "Income_Count": income_counts,
                "Income_Percentage": income_pct,
                "Expense_Count": expense_counts,
                "Expense_Percentage": expense_pct,
            }
        ).fillna(0)
        existing_categories = [
            cat for cat in self.category_order if cat in viz_data.index
        ]
        viz_data = viz_data.reindex(existing_categories)
        return {
            "categories": list(viz_data.index),
            "income_percentages": viz_data["Income_Percentage"].tolist(),
            "expense_percentages": viz_data["Expense_Percentage"].tolist(),
            "income_counts": viz_data["Income_Count"].astype(int).tolist(),
            "expense_counts": viz_data["Expense_Count"].astype(int).tolist(),
        }

    def get_profession_chart_data(self):
        if self.df is None:
            self.load_data()
        profession_standing = (
            pd.crosstab(
                self.df["employment_status"],
                self.df["financial_standing"],
                normalize="index",
            )
            * 100
        )
        employment_counts = self.df["employment_status"].value_counts()
        profession_standing = profession_standing.reindex(employment_counts.index)
        categories = profession_standing.index.tolist()
        colors = {"Surplus": "#2ecc71", "Break-even": "#f39c12", "Deficit": "#e74c3c"}
        chart_data = {
            "categories": categories,
            "financial_standings": list(profession_standing.columns),
            "data": {},
            "colors": colors,
            "total_counts": employment_counts.to_dict(),
        }
        for standing in profession_standing.columns:
            chart_data["data"][standing] = (
                profession_standing[standing].round(1).tolist()
                if standing in profession_standing.columns
                else [0] * len(categories)
            )
        return chart_data

    def get_education_chart_data(self):
        if self.df is None:
            self.load_data()
        education_order = [
            "Elementary School",
            "Junior High School",
            "Senior High School",
            "Diploma I/II/III",
            "Bachelor (S1)/Diploma IV",
            "Postgraduate",
        ]
        education_standing = (
            pd.crosstab(
                self.df["education_level"],
                self.df["financial_standing"],
                normalize="index",
            )
            * 100
        )
        existing_education = [
            edu for edu in education_order if edu in education_standing.index
        ]
        education_standing = education_standing.reindex(existing_education)
        education_counts = self.df["education_level"].value_counts()
        categories = education_standing.index.tolist()
        colors = {"Surplus": "#2ecc71", "Break-even": "#f39c12", "Deficit": "#e74c3c"}
        chart_data = {
            "categories": categories,
            "financial_standings": list(education_standing.columns),
            "data": {},
            "colors": colors,
            "total_counts": education_counts.to_dict(),
        }
        for standing in education_standing.columns:
            chart_data["data"][standing] = (
                education_standing[standing].round(1).tolist()
                if standing in education_standing.columns
                else [0] * len(categories)
            )
        return chart_data

    def get_filtered_loan_overview(self, income_category=None):
        if self.df is None:
            self.load_data()
        return LoanProcessor(self.df).get_filtered_loan_data_by_income(income_category)

    def get_filtered_loan_purpose_data(self, income_category=None):
        if self.df is None:
            self.load_data()
        filtered_df = (
            self.df[self.df["avg_income_category"] == income_category].copy()
            if income_category and income_category != "All"
            else self.df.copy()
        )
        return LoanProcessor(filtered_df).get_loan_purpose_distribution()

    def get_filtered_engagement_data(self, income_category=None):
        if self.df is None:
            self.load_data()
        baseline_data = EngagementProcessor(self.df).get_engagement_distribution()
        if income_category and income_category != "All":
            filtered_df = self.df[
                self.df["avg_income_category"] == income_category
            ].copy()
            filtered_data = EngagementProcessor(
                filtered_df
            ).get_engagement_distribution()
        else:
            filtered_data = baseline_data
        return {"filtered_data": filtered_data, "baseline_kde": baseline_data["kde"]}


def get_visual_analytics_data():
    loader = DataLoader(NEW_DATASET_PATH)
    chart_data = loader.get_chart_data()
    profession_data = loader.get_profession_chart_data()
    education_data = loader.get_education_chart_data()

    return {
        "chart_html": ChartGenerator.create_diverging_bar_chart(chart_data),
        "profession_chart": ChartGenerator.create_profession_chart(profession_data),
        "education_chart": ChartGenerator.create_education_chart(education_data),
    }


def get_filtered_loan_data(category):
    loader = DataLoader(NEW_DATASET_PATH)
    return loader.get_filtered_loan_overview(category)


def get_loan_purpose_data(category):
    loader = DataLoader(NEW_DATASET_PATH)
    return loader.get_filtered_loan_purpose_data(category)


def get_digital_time_data(category):
    loader = DataLoader(NEW_DATASET_PATH)
    return loader.get_filtered_engagement_data(category)


# --- Functions for Map Panel ---

def clean_regional_data(df):
    df = df.rename(
        columns={
            "Provinsi": "provinsi",
            "Jumlah Rekening Penerima Pinjaman Aktif (entitas)": "rekening_penerima_aktif",
            "Jumlah Dana yang Diberikan (Rp miliar)": "dana_diberikan_miliar",
            "Jumlah Rekening Pemberi Pinjaman (akun)": "rekening_pemberi",
            "TWP 90%": "twp_90",
            "Jumlah Penerima Pinjaman (akun)": "jumlah_penerima",
            "Outstanding Pinjaman (Rp miliar)": "outstanding_pinjaman_miliar",
            "Jumlah Penduduk (Ribu)": "jumlah_penduduk_ribu",
            "PDRB (Ribu Rp)": "pdrb_ribu_rp",
            "Urbanisasi (%)": "urbanisasi_persen",
        }
    )

    numeric_cols = [
        "rekening_penerima_aktif",
        "dana_diberikan_miliar",
        "rekening_pemberi",
        "twp_90",
        "jumlah_penerima",
        "outstanding_pinjaman_miliar",
        "jumlah_penduduk_ribu",
        "pdrb_ribu_rp",
        "urbanisasi_persen",
    ]

    for col in numeric_cols:
        df[col] = df[col].replace("-", pd.NA)
        if df[col].dtype == "object":
            df[col] = df[col].str.replace(".", "", regex=False)
            df[col] = df[col].str.replace("%", "", regex=False)
            df[col] = df[col].str.replace(",", ".", regex=False)
        df[col] = pd.to_numeric(df[col], errors="coerce")

    return df


def clean_and_aggregate_financial_data(df):
    """Membersihkan dan mengagregasi data profil finansial per provinsi."""
    numeric_cols = [
        "avg_monthly_income (INT)",
        "avg_monthly_expense (INT)",
        "financial_anxiety_score",
        "digital_time_spent_per_day",
    ]
    for col in numeric_cols:
        df[col] = pd.to_numeric(df[col], errors="coerce")

    # Agregasi: mean untuk numerik, mode untuk kategorikal
    agg_functions = {
        "avg_monthly_income (INT)": "mean",
        "avg_monthly_expense (INT)": "mean",
        "financial_anxiety_score": "mean",
        "digital_time_spent_per_day": "mean",
        "main_fintech_app": lambda x: x.mode().iloc[0] if not x.mode().empty else None,
        "investment_type": lambda x: x.mode().iloc[0] if not x.mode().empty else None,
    }

    agg_df = df.groupby("province").agg(agg_functions).reset_index()

    # Hitung persentase pengguna untuk fintech app yang paling populer
    fintech_percentage = []
    for province in agg_df["province"]:
        province_data = df[df["province"] == province]
        if len(province_data) > 0:
            most_popular_app = (
                province_data["main_fintech_app"].mode().iloc[0]
                if not province_data["main_fintech_app"].mode().empty
                else None
            )
            if most_popular_app:
                percentage = (
                    (province_data["main_fintech_app"] == most_popular_app).sum()
                    / len(province_data)
                    * 100
                )
                fintech_percentage.append(round(percentage, 1))
            else:
                fintech_percentage.append(0)
        else:
            fintech_percentage.append(0)

    agg_df["fintech_percentage"] = fintech_percentage

    # Ganti nama kolom agar lebih mudah digunakan di frontend
    agg_df = agg_df.rename(
        columns={
            "province": "provinsi",
            "avg_monthly_income (INT)": "avg_income",
            "avg_monthly_expense (INT)": "avg_expense",
            "financial_anxiety_score": "avg_anxiety_score",
            "digital_time_spent_per_day": "avg_digital_time",
            "main_fintech_app": "mode_fintech_app",
            "investment_type": "mode_investment_type",
        }
    )

    agg_df["financial_balance"] = agg_df["avg_income"] - agg_df["avg_expense"]

    for col in [
        "avg_income",
        "avg_expense",
        "avg_anxiety_score",
        "avg_digital_time",
        "financial_balance",
    ]:
        agg_df[col] = agg_df[col].round(2)

    return agg_df

def get_regional_data_from_file():
    """Endpoint untuk data indikator ekonomi regional."""
    try:
        df = pd.read_csv(os.path.join(os.path.dirname(__file__), "..", "dataset", "Dataset Gelarrasa - Regional_Economic_Indicators.csv"))
        df_cleaned = clean_regional_data(df)
        df_final = df_cleaned.replace({np.nan: None})
        return df_final.to_dict(orient="records")
    except FileNotFoundError:
        return {"error": "File Regional_Economic_Indicators.csv tidak ditemukan"}, 404
    except Exception as e:
        return {"error": str(e)}, 500


def get_financial_data_from_file():
    """Endpoint untuk data profil finansial Gen Z yang sudah diagregasi."""
    try:
        df = pd.read_csv(os.path.join(os.path.dirname(__file__), "..", "dataset", "Dataset Gelarrasa - GenZ_Financial_Profile_map.csv"))
        df_agg = clean_and_aggregate_financial_data(df)
        df_final = df_agg.replace({np.nan: None})
        return df_final.to_dict(orient="records")
    except FileNotFoundError:
        return {"error": "File dataset_gelarrasa_genzfinancialprofile.csv tidak ditemukan"}, 404
    except Exception as e:
        return {"error": str(e)}, 500


--- Dashboard_temp/app/templates/components/knowledge-card.html ---

<!-- Knowledge Card -->
<div class="main-card card-knowledge">
    <div class="card-content">
        <h2>{{ data.knowledge_card.title }}</h2>
    </div>
    <div class="illustration light" id="lightbulb">
        <svg viewBox="0 0 100 100">
            <g id="bulb-base">
                <rect x="35" y="75" width="30" height="5" rx="2" fill="var(--illust-base)"/>
                <rect x="38" y="80" width="24" height="4" rx="2" fill="var(--illust-base)"/>
                <rect x="35" y="84" width="30" height="5" rx="2" fill="var(--illust-base)"/>
                <path d="M 40 89 H 60" stroke="var(--illust-base)" stroke-width="3" stroke-linecap="round"/>
            </g>
            <path id="bulb-glass" d="M50,0 C30,0 20,20 20,40 C20,65 35,75 50,75 C65,75 80,65 80,40 C80,20 70,0 50,0 Z" fill="var(--card1-illust-main)" stroke="var(--illust-stroke)" stroke-width="2" fill-opacity="0.2"/>
            <g id="bulb-filament" stroke="var(--illust-stroke)" stroke-width="2" stroke-linecap="round">
                <line x1="40" y1="75" x2="45" y2="55" />
                <line x1="60" y1="75" x2="55" y2="55" />
                <line x1="45" y1="55" x2="55" y2="55" />
            </g>
            <g id="bulb-rays" stroke="var(--illust-stroke)" stroke-width="2" stroke-linecap="round" opacity="0">
                <line x1="50" y1="-10" x2="50" y2="-20" />
                <line x1="75" y1="15" x2="85" y2="5" />
                <line x1="90" y1="40" x2="100" y2="40" />
                <line x1="25" y1="15" x2="15" y2="5" />
                <line x1="10" y1="40" x2="0" y2="40" />
            </g>
        </svg>
    </div>
    <div class="card-footer">
        <div class="card-footer-item">
            <div class="card-footer-label">
                <i class="fa-solid fa-book-open"></i>
                <span>Literasi Finansial</span>
            </div>
            <div class="card-footer-value" id="scoreLiterasiFin" data-score="{{ data.knowledge_card.score_literasi_finansial }}" data-original-score="{{ data.knowledge_card.score_literasi_finansial }}">{{ data.knowledge_card.score_literasi_finansial }}</div>
        </div>
        <div class="card-footer-item">
            <div class="card-footer-label">
                <i class="fa-solid fa-laptop"></i>
                <span>Literasi Keuangan Digital</span>
            </div>
            <div class="card-footer-value" id="scoreLiterasiDigital" data-score="{{ data.knowledge_card.score_literasi_digital }}" data-original-score="{{ data.knowledge_card.score_literasi_digital }}">{{ data.knowledge_card.score_literasi_digital }}</div>
        </div>
    </div>
    <div class="bg-shapes">
        <div class="shape shape1"></div>
        <div class="shape shape2"></div>
        <div class="shape shape3"></div>
    </div>
</div>


--- Dashboard_temp/app/templates/components/wellbeing-card.html ---

<!-- Wellbeing Card -->
<div class="main-card card-wellbeing">
    <div class="card-content">
        <h2>{{ data.wellbeing_card.title }}</h2>
    </div>
    <div class="illustration house" id="wellbeing">
        <svg viewBox="0 0 220 150">
            <line x1="20" y1="120" x2="200" y2="120" stroke="var(--illust-ground)" stroke-width="2" />
            <g id="coins" fill="var(--card3-illust-main)" stroke="var(--card3-illust-dark)" stroke-width="1">
                <circle class="coin" cx="55" cy="116" r="6" />
                <circle class="coin" cx="70" cy="112" r="6" />
                <circle class="coin" cx="85" cy="108" r="6" />
            </g>
            <g id="house">
                <g id="roof" fill="var(--card3-illust-roof)" stroke="var(--illust-stroke)" stroke-width="2">
                    <polygon points="110,45 70,70 150,70"/>
                </g>
                <g id="body" fill="var(--illust-window-body)" stroke="var(--illust-stroke)" stroke-width="2">
                    <rect x="75" y="70" width="80" height="50" rx="6"/>
                    <rect x="110" y="90" width="18" height="30" fill="var(--illust-base)" stroke="var(--illust-stroke)"/>
                    <rect id="left-window" x="85" y="80" width="16" height="14" rx="2" fill="var(--card3-illust-accent)" stroke="var(--illust-stroke)"/>
                    <rect id="right-window" x="134" y="80" width="16" height="14" rx="2" fill="var(--card3-illust-accent)" stroke="var(--illust-stroke)"/>
                </g>
            </g>
        </svg>
    </div>
    <div class="card-footer">
        <div class="card-footer-item">
            <div class="card-footer-label">
                <i class="fa-solid fa-heart"></i>
                <span>Kesejahteraan Finansial</span>
            </div>
            <div class="card-footer-value" id="scoreKesejahteraan" data-score="{{ data.wellbeing_card.score_kesejahteraan }}" data-original-score="{{ data.wellbeing_card.score_kesejahteraan }}">{{ data.wellbeing_card.score_kesejahteraan }}</div>
        </div>
        <div class="card-footer-item">
            <div class="card-footer-label">
                <i class="fa-solid fa-coins"></i>
                <span>Investasi Aset</span>
            </div>
            <div class="card-footer-value" id="scoreInvestasi" data-score="{{ data.wellbeing_card.score_investasi }}" data-original-score="{{ data.wellbeing_card.score_investasi }}">{{ data.wellbeing_card.score_investasi }}</div>
        </div>
    </div>
    <div class="bg-shapes">
        <div class="sparkle sparkle1"></div>
        <div class="sparkle sparkle2"></div>
        <div class="sparkle sparkle3"></div>
        <div class="sparkle sparkle4"></div>
        <div class="sparkle sparkle5"></div>
        <div class="coin-shape coin1"></div>
        <div class="coin-shape coin2"></div>
        <div class="coin-shape coin3"></div>
    </div>
</div>


--- Dashboard_temp/app/templates/components/map_panel.html ---

<!-- templates/components/map_panel.html -->
<div class="charts-section-panel">
    <div class="map-card">
        <div class="map-controls">
            <span class="custom-dropdown" id="map-dataset-dropdown">
                <span class="dropdown-selected">Indikator Ekonomi Regional â–¼</span>
                <ul class="dropdown-options">
                    <li data-value="regional">Indikator Ekonomi Regional</li>
                    <li data-value="financial">Profil Finansial Gen Z</li>
                </ul>
            </span>
            <span class="custom-dropdown" id="map-metric-dropdown">
                <span class="dropdown-selected">Pilih Metrik â–¼</span>
                <ul class="dropdown-options">
                    <!-- Options will be populated by JS -->
                </ul>
            </span>
            <button id="reset-zoom-btn" class="map-control-button">ðŸ”„ Reset Zoom</button>
        </div>
        <div id="container" style="width: 100%; height: 300px;"></div>
    </div>
</div>

--- Dashboard_temp/app/templates/components/behavior-card.html ---

<!-- Behavior Card -->
<div class="main-card card-behavior">
    <div class="card-content">
        <h2>{{ data.behavior_card.title }}</h2>
    </div>
    <div class="illustration scales" id="scales">
        <svg viewBox="0 0 200 150">
            <g id="scale-stand" stroke="var(--illust-stroke)" stroke-width="2" fill="none">
                <line x1="100" y1="120" x2="100" y2="30"/>
                <line x1="70" y1="120" x2="130" y2="120"/>
            </g>
            <g id="scale-beam" stroke="var(--illust-stroke)" stroke-width="2" fill="none" transform-origin="100 30">
                <path d="M 20 30 Q 100 20 180 30" stroke="var(--card2-illust-main)" stroke-width="4"/>
                <g id="left-pan">
                    <line x1="20" y1="30" x2="35" y2="70" />
                    <path d="M 10 70 Q 35 85 60 70" fill="var(--card2-illust-accent)" stroke-linecap="round"/>
                </g>
                <g id="right-pan">
                    <line x1="180" y1="30" x2="165" y2="70" />
                    <path d="M 140 70 Q 165 85 190 70" fill="var(--card2-illust-accent)" stroke-linecap="round"/>
                </g>
            </g>
        </svg>
    </div>
    <div class="card-footer">
        <div class="card-footer-item">
            <div class="card-footer-label">
                <i class="fa-solid fa-wallet"></i>
                <span>Pengelolaan Keuangan</span>
            </div>
            <div class="card-footer-value" id="scorePengelolaan" data-score="{{ data.behavior_card.score_pengelolaan }}" data-original-score="{{ data.behavior_card.score_pengelolaan }}">{{ data.behavior_card.score_pengelolaan }}</div>
        </div>
        <div class="card-footer-item">
            <div class="card-footer-label">
                <i class="fa-solid fa-chart-line"></i>
                <span>Sikap Finansial</span>
            </div>
            <div class="card-footer-value" id="scorePerilaku" data-score="{{ data.behavior_card.score_perilaku }}" data-original-score="{{ data.behavior_card.score_perilaku }}">{{ data.behavior_card.score_perilaku }}</div>
        </div>
        <div class="card-footer-item">
            <div class="card-footer-label">
                <i class="fa-solid fa-star"></i>
                <span>Disiplin Finansial</span>
            </div>
            <div class="card-footer-value" id="scoreDisiplin" data-score="{{ data.behavior_card.score_disiplin }}" data-original-score="{{ data.behavior_card.score_disiplin }}">{{ data.behavior_card.score_disiplin }}</div>
        </div>
    </div>
    <div class="bg-shapes">
        <div class="particle particle1"></div>
        <div class="particle particle2"></div>
        <div class="particle particle3"></div>
        <div class="particle particle4"></div>
        <div class="particle particle5"></div>
        <div class="particle particle6"></div>
        <div class="particle particle7"></div>
    </div>
</div>


--- Dashboard_temp/app/templates/components/digital_time_spent.html ---

<!-- templates/components/digital_time_spent.html -->
<div class="charts-section-panel">
    <!-- Digital Engagement Chart -->
    <div class="row">
        <div class="col-12">
            <div class="chart-container">
                <div id="digital-time-chart" style="width: 100%; height: 380px;">
                    <div class="placeholder-content"
                        style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <h6 class="mt-3 text-muted">Loading Digital Engagement Data...</h6>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


--- Dashboard_temp/app/templates/components/visual_analytics.html ---

<!-- templates/components/visual_analytics.html -->
<div class="visualization-grid">
    <!-- Main Chart - 60% -->
    <div class="viz-panel viz-main">
        <div class="viz-content">
            {{ chart_html|safe }}
        </div>
        <div class="viz-footer">
            <small class="text-muted">
                <i class="fas fa-mouse-pointer me-1"></i>
                Interactive filtering enabled â€¢ Selected category shows in <strong style="color: #e67e22;">orange</strong>
            </small>
        </div>
    </div>
    
    <!-- Profession Chart - 20% -->
    <div class="viz-panel viz-side" id="profession-panel">
        <div class="viz-content">
            {{ profession_chart|safe }}
        </div>
        <div class="viz-footer">
            <small class="text-muted">
                Employment status vs financial outcomes
            </small>
        </div>
    </div>
    
    <!-- Education Chart - 20% -->
    <div class="viz-panel viz-side" id="education-panel">
        <div class="viz-content">
            {{ education_chart|safe }}
        </div>
        <div class="viz-footer">
            <small class="text-muted">
                Education level's impact on stability
            </small>
        </div>
    </div>
</div>


--- Dashboard_temp/app/templates/components/loan_overview.html ---

<!-- templates/components/loan_overview.html -->
<div class="charts-section-panel">
    <h4 class="mb-3">
        <i class="fas fa-hand-holding-usd"></i> Outstanding Loan Overview
    </h4>

    <!-- KPI Cards -->
    <div class="loan-kpi-cards">
        <div class="loan-kpi-card primary">
            <div class="loan-kpi-label">Total with Loans</div>
            <div class="loan-kpi-value" id="loan-total-value"></div>
            <div class="loan-kpi-subtext" id="loan-total-subtext"></div>
        </div>
        <div class="loan-kpi-card success">
            <div class="loan-kpi-label">Average Loan</div>
            <div class="loan-kpi-value" id="loan-avg-value"></div>
            <div class="loan-kpi-subtext">Among borrowers</div>
        </div>
        <div class="loan-kpi-card warning">
            <div class="loan-kpi-label" id="loan-third-label">Total Outstanding</div>
            <div class="loan-kpi-value" id="loan-third-value"></div>
            <div class="loan-kpi-subtext" id="loan-third-subtext"></div>
        </div>
        <div class="loan-kpi-card danger">
            <div class="loan-kpi-label">Maximum Loan</div>
            <div class="loan-kpi-value" id="loan-max-value"></div>
            <div class="loan-kpi-subtext">Highest outstanding</div>
        </div>
    </div>

    <!-- Loan Charts Section -->
    <div class="loan-charts-grid mt-3">
        <div class="chart-container">
            <div id="loan-overview-chart"></div>
        </div>
        <div class="chart-container">
            <div id="loan-purpose-chart"></div>
        </div>
    </div>
</div>

--- Dashboard_temp/app/templates/components/hero-section.html ---

<!-- templates/components/hero-section.html -->

<!-- New header to split the title and the anxiety stat -->
<div class="sidebar-header">
    <div class="sidebar-header__title">
        <h1 class="hero-title">{{ data.hero_section.title }}</h1>
    </div>
    <div class="sidebar-header__stat">
        <!-- The entire anxiety stat component is moved here -->
        <div class="hero-chart-container hero-chart-container--stat" id="anxiety-container">
            <div class="anxiety-stat" aria-label="Financial anxiety gauge">
                <div class="anxiety-face-wrapper">
                    <div id="anxiety-emoji" class="anxiety-emoji"></div>
                </div>
                <div class="anxiety-gauge">
                    <div class="anxiety-gauge__track">
                        <div id="anxiety-gauge-fill" class="anxiety-gauge__fill" style="height: 0%"></div>
                    </div>
                    <div class="anxiety-gauge__scale" aria-hidden="true">
                        <span>1</span><span>2</span><span>3</span><span>4</span><span>5</span>
                    </div>
                </div>
                <div id="avgAnxietyScore" class="anxiety-gauge__value" data-score="{{ data.hero_section.anxiety_score }}" data-original-score="{{ data.hero_section.anxiety_score }}">{{ data.hero_section.anxiety_score }}</div>
            </div>
            <p class="stat-label">Average Financial Anxiety Score (1-5)</p>
        </div>
    </div>
</div>

<!-- The Bar Chart Container now includes the description -->
<div class="hero-chart-container hero-chart-container--chart">
    <!-- The description is now inside this container -->
    <div class="hero-description-container">
        <p class="hero-description">
            Data Gen Z Paling Financially anxious berdasarkan
        </p>
        <span class="custom-dropdown">
            <span class="dropdown-selected">ðŸ’¼ Pekerjaan â–¼</span>
            <ul class="dropdown-options">
                <li data-value="employment_status">ðŸ’¼ Pekerjaan</li>
                <li data-value="education_level">ðŸŽ“ Pendidikan</li>
                <li data-value="gender">ðŸš» Gender</li>
                <li data-value="birth_year">ðŸŽ‚ Usia</li>
            </ul>
        </span>
    </div>
    <!-- The chart itself -->
    <div id="anxietyBarChart" class="hero-chart"></div>
</div>

--- Dashboard_temp/app/templates/index.html ---

<!-- templates/index.html -->
{% extends "layout.html" %}

{% block title %}
    Dashboard Overview
{% endblock %}

{% block content %}
<div class="dashboard-window">
    
    <!-- This is the new two-column container -->
    <div class="dashboard-container">
        <!-- Left Sidebar Panel -->
        <aside class="left-panel">
            {% include 'components/hero-section.html' %}
            {% include 'components/knowledge-card.html' %}
            {% include 'components/behavior-card.html' %}
            {% include 'components/wellbeing-card.html' %}
        </aside>

        <!-- Right Main Content Panel -->
        <main class="right-panel">
            <div class="main-content-grid">
                <div class="grid-item">
                    {% include 'components/visual_analytics.html' %}
                </div>
                <div class="grid-item">
                    {% include 'components/loan_overview.html' %}
                </div>
                <div class="full-width-row">
                    {% include 'components/digital_time_spent.html' %}
                </div>
                <div class="full-width-row">
                    {% include 'components/map_panel.html' %}
                </div>
            </div>
        </main>
    </div>
</div>
{% endblock %}

--- Dashboard_temp/app/templates/layout.html ---

<!-- templates/layout.html -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Define a block for the title -->
    <title>{% block title %}Gen Z Financial Dashboard{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- MODIFIED: Added the Google Font "Outfit" with various weights -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Outfit:wght@400;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layout/main-content.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components/map_controls.css') }}">
    
    <!-- Define a block for any extra head content -->
    {% block head %}{% endblock %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.4/ScrollTrigger.min.js"></script>
    <script>gsap.registerPlugin(ScrollTrigger);</script>
    <script src="https://code.highcharts.com/maps/highmaps.js"></script>
    <script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/highcharts-more.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist-min@latest/plotly.min.js"></script>
</head>
<body>

    <!-- Define the main content block -->
    {% block content %}{% endblock %}



    <script src="{{ url_for('static', filename='js/components/lightbulb-animation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/scales-animation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/wellbeing-animation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-text-animation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/dropdown-animation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts/anxiety-face-animation/elements.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts/anxiety-face-animation/animations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts/anxiety-face-animation/observers.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts/anxiety-face-animation.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts/anxiety-bar-chart/chart-config.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts/anxiety-bar-chart/chart-data.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts/anxiety-bar-chart/chart-events.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts/anxiety-bar-chart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/hero-charts.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/loan_panel.js') }}"></script>
    <script src="{{ url_for('static', filename='js/components/digital_time_chart.js') }}"></script>
    <script src="{{ url_for('static', filename='js/background-shapes.js') }}"></script>
    <script src="{{ url_for('static', filename='js/counter.js') }}"></script>
    <script src="{{ url_for('static', filename='js/animations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/new_charts_animations.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/chart-styler.js') }}"></script>
    <script type="module" src="{{ url_for('static', filename='js/components/map/app.js') }}"></script>
    
</body>
</html>

--- Dashboard_temp/STYLE_GUIDE_PROMPT.md ---

# System Prompt: Gen Z Financial Dashboard Style Guide

You are an expert front-end developer tasked with maintaining and extending the "Gen Z Financial Dashboard" project. Your primary goal is to adhere strictly to the existing architecture, coding style, and design principles to ensure consistency, maintainability, and a high-quality developer experience (DX).

## Core Principles
1.  **Modularity:** The entire codebase is modular. Every new feature or component must be broken down into its own dedicated files for HTML, CSS, and JavaScript.
2.  **DRY (Don't Repeat Yourself):** Actively look for opportunities to create reusable functions, styles, and variables. Avoid code duplication at all costs.
3.  **Clarity and Readability:** Write clean, well-commented code. File and function names should be descriptive and intuitive.

---

## 1. HTML Structure

-   **Component-Based:** The `index.html` file is a simple shell. All UI elements are defined as separate HTML fragments in the `/components` directory.
-   **Dynamic Loading:** A central script (`scripts/main.js`) is responsible for fetching these HTML components and dynamically injecting them into the main page. When adding a new UI section, you must create a new file in `/components` and add it to the loading sequence in `scripts/main.js`.
-   **Semantic HTML:** Use semantic tags (`<header>`, `<main>`, `<nav>`, etc.) where appropriate.
-   **Data Normalization:** When handling categorical data (e.g., employment status, education levels), ensure that variations in spelling and casing are normalized in the backend (`services.py`) before rendering to maintain consistency across charts and filters.

---

## 2. CSS Styling

-   **Directory Structure:**
    -   `/styles/base`: Global styles, variables, and resets (`base.css`, `colors.css`, `variables.css`).
    -   `/styles/components`: Shared, cross-component styles (e.g., `main-cards.css`, `card-footer.css`, `background-shapes.css`). Keep this for generic rules only.
    -   `/styles/layout`: Major layout rules, like the main grid (`layout.css`).
    -   Component-scoped CSS is colocated with the component: `components/<component>/<component>.css` (e.g., `components/knowledge-card/knowledge-card.css`).
-   **CSS Variables are Mandatory:**
    -   **All colors** must be defined as CSS variables in `styles/base/colors.css`. Never use hardcoded hex codes or color names in component stylesheets. Always reference colors using `var(--color-name)`.
    -   **All reusable spacing values** (padding, margins, gaps) and layout properties (border-radius) must be defined as variables in `styles/base/variables.css`.
-   **Entry Point:** The `styles/main.css` file is the single entry point, which uses `@import` to load all other stylesheets in the correct cascade order. When adding a new component, add its `@import` rule to `main.css`, using a relative path to the component folder (e.g., `@import url('../components/header/header.css');`).
-   **Naming Convention:** Use a descriptive, BEM-like naming convention (e.g., `.card-footer`, `.card-footer-label`, `.card-footer-value`) to keep styles scoped and understandable.

---

## 3. JavaScript and Animations

-   **GSAP is the Standard:** All animations must be implemented using the GSAP (GreenSock Animation Platform) library.
-   **Animation Vibe:** Animations should be smooth, fluid, and engaging.
    -   Use gentle easing functions like `"power3.out"` or `"sine.inOut"` as a default.
    -   Animations should feel responsive and interactive (e.g., triggering on hover or scroll).
    -   Strive for subtlety. Avoid overly fast or jarring movements.
-   **Modular, Component-Colocated Animations:**
    -   Do not write all animation code in one file.
    -   Each distinct animated component must have its own JavaScript file colocated with the component under `components/<component>/` (e.g., `components/knowledge-card/lightbulb-animation.js`, `components/behavior-card/scales-animation.js`).
    -   Cross-component/shared animation utilities (e.g., background shapes, counters) live in `/scripts/` (e.g., `scripts/background-shapes.js`, `scripts/counter.js`).
    -   All modular animation files should expose self-contained `init...()` functions.
-   **Centralized Initialization:** `scripts/animations.js` remains the main animation controller. It imports nothing directly; instead, it assumes component animation scripts are loaded on the page and calls their `init...()` functions inside `initAllAnimations()`.
    -   Load order in `index.html`: GSAP + ScrollTrigger, component animation scripts, shared animation utilities, then `scripts/animations.js`, then `scripts/main.js`.
-   **Performance:** Use `ScrollTrigger` (or the existing `IntersectionObserver` in `scrollTrigger.js`) to ensure animations only run when elements are visible in the viewport.


--- Dashboard_temp/METRIC_CALCULATION.md ---

# Financial Health Metric Calculation Logic

## Overview

This document explains how the raw survey data from `dataset/Sheet2.csv` is processed to calculate the seven financial health metrics displayed on the dashboard. The raw score for each question is on a **1 to 4 scale**. The process involves three key steps:

1.  **Categorization**: Each relevant question from the survey is mapped to one of the seven core financial metrics.
2.  **Polarity Reversal**: Certain questions are phrased negatively, where a high score indicates a poor outcome. These questions have their scores reversed.
3.  **Normalization**: The final average score for each metric is converted to a percentage (0-100) for display on the dashboard.

## 1. Metric Categorization

The following table shows which questions from `Sheet2.csv` are averaged to calculate each of the seven metrics.

### Knowledge Card

| Metric | Questions from `Sheet2.csv` |
| :--- | :--- |
| **Literasi Finansial** | `I am able to identify risks and discrepancies and view numbers in a complex way` <br> `I am able to understand what is behind the numbers` <br> `I am able to understand numbers and financial metrics` <br> `I am able to understand what drives cash flow and profits` <br> `I am able to understand the company's financial statements and some core performance measures` <br> `I pay attention to news about the economy as it may affect my family` |
| **Literasi Keuangan Digital** | `Awareness about the potential of financial risk in using digital financial provider or fintech, such as the legality of the fintech provider, interest rate and transaction fee` <br> `Having experience in using the product and service of fintech for digital payment` <br> `Having a good understanding of digital payment products such as E-Debit, E-Credit, E-Money, Mobile/Internet banking, E -wallet` <br> `Having a good understanding of digital alternatives` <br> `Having a good understanding of digital insurance` <br> `Having a good understanding of customer rights and protection as well as the procedure to complain about the service from digital  financial providers` |

### Behavior Card

| Metric | Questions from `Sheet2.csv` |
| :--- | :--- |
| **Pengelolaan Keuangan** | `I am able to manage my budget and divide it accordingly across an allotted period to the right concerned areas` <br> `I am able to project the amount of cash that will be available to me in the future` <br> `I take part in domestic expense planning` <br> `I suggest at home that we keep money aside for emergencies` <br> `I am able to search for economic options during financial decision making` <br> `I am able to foresee the long term and short-term consequences of the financial decisions I undertake` |
| **Sikap Finansial** | `I usually have a critical view of the way my friends deal with money` <br> `I like to participate in family decision making when we buy something expensive for home` <br> `I advise others on money matters` <br> `I often do things without giving them much thought` <br> `I am impulsive` <br> `I say things before I have thought them through` <br> `I am able to quickly change my financial decisions as per the changes in circumstance` <br> `Appraise of personal risk helps me in better financial decision making` <br> `I make sound financial decision by comparing results over the time` <br> `I make sound financial decisions by comparing results over expenses involved` <br> `Previously used decision strategies help me in better financial decision making` |
| **Disiplin Finansial** | `I am able to plan ahead to avoid impulse spending` <br> `I always try to save some money to do things I really like` <br> `I always like to negotiate prices when I buy` <br> `I keep an eye on promotions and discounts` <br> `I like to think thoroughly before deciding to buy something` <br> `I like to research prices whenever I buy something` |

### Wellbeing Card

| Metric | Questions from `Sheet2.csv` |
| :--- | :--- |
| **Kesejahteraan Finansial** | `I am becoming financially secure` <br> `I am securing my financial future` <br> `I will achieve the financial goals that I have set for myself` <br> `I have saved (or will be able to save) enough money to last me to the end of my life` <br> `Because of my money situation, I feel I will never have the things I want in life` <br> `I am behind with my finances` <br> `My finances control my life` <br> `Whenever I feel in control of my finances, something happens that sets me back` <br> `I am unable to enjoy life because I obsess too much about money` |
| **Investasi Aset** | `I am able to recognize a good financial investment` <br> `Experience in using the product and service of fintech for financing (loan) and investment` <br> `Experience in using the product and service of fintech for asset management` <br> `Having a good understanding of product digital asset management` |

---

## 2. Negative Polarity Questions

For standard questions, a higher score is better. However, for negative polarity questions, a higher score indicates a negative behavior or feeling. For example, strongly agreeing with "I am impulsive" is not a positive financial indicator.

To correct for this, we reverse the scores for these questions using the following formula:

`new_score = 5 - original_score`

The following questions are treated as having negative polarity:

- `I often do things without giving them much thought`
- `I am impulsive`
- `I say things before I have thought them through`
- `Because of my money situation, I feel I will never have the things I want in life`
- `I am behind with my finances`
- `My finances control my life`
- `Whenever I feel in control of my finances, something happens that sets me back`
- `I am unable to enjoy life because I obsess too much about money`

---

## Data Quality Notes

### Employment Status Normalization

The system normalizes various spellings of employment categories to ensure consistency:
- **Entrepreneur**: Handles variations like "Enterpreneur", "entrepreneur"
- **Civil Servant/BUMN**: Maps to "Civil Servant/BUMN or Local Government" in Sheet2
- **Not Working**: Standardized across datasets
- **Student**: Standardized across datasets
- **Private Employee**: Standardized across datasets

This normalization occurs automatically during data loading and filtering to prevent mismatches between user selections and actual data values.


--- Dashboard_temp/requirements.txt ---

blinker==1.9.0
cachetools==6.2.1
certifi==2025.10.5
charset-normalizer==3.4.4
click==8.3.0
Flask==3.1.2
google-auth==2.41.1
google-auth-oauthlib==1.2.3
gspread==6.2.1
idna==3.11
itsdangerous==2.2.0
Jinja2==3.1.6
MarkupSafe==3.0.3
numpy==2.3.4
oauthlib==3.3.1
pandas==2.3.3
pyasn1==0.6.1
pyasn1_modules==0.4.2
python-dateutil==2.9.0.post0
pytz==2025.2
requests==2.32.5
requests-oauthlib==2.0.0
rsa==4.9.1
six==1.17.0
tzdata==2025.2
urllib3==2.5.0
Werkzeug==3.1.3
scipy
plotly

--- Dashboard_temp/run.py ---

from app import app

if __name__ == '__main__':
    app.run(debug=True)